<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>OnCall Assistant | MedWard Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#0f766e;--primary-dark:#115e59;--primary-light:#ccfbf1;--danger:#dc2626;--danger-light:#fef2f2;--warning:#d97706;--warning-light:#fffbeb;--success:#059669;--success-light:#d1fae5;--bg:#f8fafc;--bg-card:#fff;--text:#0f172a;--text-secondary:#475569;--text-muted:#94a3b8;--border:#e2e8f0;--radius:16px;--shadow:0 1px 3px rgba(0,0,0,.08)}
[data-theme="dark"]{--primary:#2dd4bf;--primary-dark:#14b8a6;--primary-light:#134e4a;--danger:#f87171;--danger-light:#450a0a;--warning:#fbbf24;--warning-light:#451a03;--success:#4ade80;--success-light:#14532d;--bg:#0f172a;--bg-card:#1e293b;--text:#f1f5f9;--text-secondary:#cbd5e1;--text-muted:#64748b;--border:#334155}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6}
.app-header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:16px 20px;position:sticky;top:0;z-index:100}
.header-row{display:flex;align-items:center;justify-content:space-between;max-width:800px;margin:0 auto}
.header-brand{display:flex;align-items:center;gap:12px}
.header-logo{width:40px;height:40px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem}
.header-title{font-weight:700;font-size:1.1rem}
.header-subtitle{font-size:.75rem;color:var(--text-muted)}
.header-actions{display:flex;gap:8px}
.icon-btn{width:40px;height:40px;border-radius:10px;border:1px solid var(--border);background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1rem}
.main-content{max-width:800px;margin:0 auto;padding:20px;padding-bottom:100px}
.category-pills{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px;margin-bottom:20px}
.pill{flex-shrink:0;padding:8px 16px;border-radius:20px;font-size:.8rem;font-weight:600;border:1px solid var(--border);background:var(--bg-card);color:var(--text-secondary);cursor:pointer}
.pill.active{background:var(--primary);border-color:var(--primary);color:#fff}
.tool-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:12px;overflow:hidden;box-shadow:var(--shadow)}
.tool-card.emergency{border-left:4px solid var(--danger)}
.tool-header{padding:16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer}
.tool-header-left{display:flex;align-items:center;gap:12px}
.tool-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;background:var(--bg);border:1px solid var(--border)}
.tool-title{font-weight:700;font-size:.95rem}
.tool-subtitle{font-size:.8rem;color:var(--text-muted)}
.tool-badge{padding:3px 8px;border-radius:6px;font-size:.65rem;font-weight:700;text-transform:uppercase;margin-left:8px}
.tool-badge.urgent{background:var(--danger-light);color:var(--danger)}
.tool-chevron{width:28px;height:28px;border-radius:8px;background:var(--bg);display:flex;align-items:center;justify-content:center;color:var(--text-muted);transition:transform .3s}
.tool-card.expanded .tool-chevron{transform:rotate(180deg);color:var(--primary)}
.tool-content{display:none;padding:0 16px 16px}
.tool-card.expanded .tool-content{display:block}
.tool-divider{height:1px;background:var(--border);margin-bottom:16px}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:.75rem;font-weight:600;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase}
.form-input,.form-select{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:16px;background:var(--bg);color:var(--text)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:400px){.form-row{grid-template-columns:1fr}}
.gender-buttons{display:flex;gap:10px}
.gender-btn{flex:1;padding:12px;border:1px solid var(--border);border-radius:10px;background:var(--bg);font-size:.9rem;font-weight:600;cursor:pointer;color:var(--text-secondary)}
.gender-btn.selected{background:var(--primary-light);border-color:var(--primary);color:var(--primary)}
.calc-btn{width:100%;padding:14px;border:none;border-radius:10px;background:var(--primary);color:#fff;font-size:.95rem;font-weight:600;cursor:pointer}
.calc-btn.danger{background:var(--danger)}
.result-box{margin-top:16px;padding:16px;border-radius:12px;background:var(--bg);border:1px solid var(--border)}
.result-box.danger{background:var(--danger-light);border-color:var(--danger)}
.result-box.warning{background:var(--warning-light);border-color:var(--warning)}
.result-box.success{background:var(--success-light);border-color:var(--success)}
.result-title{font-weight:700;font-size:1rem;margin-bottom:8px}
.result-box.danger .result-title{color:var(--danger)}
.result-box.warning .result-title{color:var(--warning)}
.result-box.success .result-title{color:var(--success)}
.result-content{font-size:.9rem;color:var(--text-secondary);line-height:1.7}
.result-item{margin-bottom:6px;padding-left:16px;position:relative}
.result-item::before{content:"‚Ä¢";position:absolute;left:0;color:var(--primary)}
.protocol-step{background:var(--bg-card);border-radius:10px;padding:14px;margin-bottom:10px;border-left:3px solid var(--primary)}
.protocol-step.danger{border-left-color:var(--danger);background:var(--danger-light)}
.protocol-step.warning{border-left-color:var(--warning);background:var(--warning-light)}
.protocol-header{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.protocol-number{width:24px;height:24px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem}
.protocol-step.danger .protocol-number{background:var(--danger)}
.protocol-step.warning .protocol-number{background:var(--warning)}
.protocol-title{font-weight:700;font-size:.9rem}
.protocol-content{font-size:.85rem;color:var(--text-secondary);margin-left:34px}
.escalation-box{background:var(--warning-light);border:1px solid var(--warning);border-radius:12px;padding:16px;margin-top:16px}
.escalation-title{font-weight:700;font-size:.9rem;color:var(--warning);margin-bottom:10px}
.escalation-criteria{font-size:.85rem;color:var(--text-secondary);list-style:none}
.escalation-criteria li{margin-bottom:6px;padding-left:24px;position:relative}
.escalation-criteria li::before{content:"‚ö†Ô∏è";position:absolute;left:0;font-size:.8rem}
.prn-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(max-width:500px){.prn-grid{grid-template-columns:repeat(2,1fr)}}
.prn-card{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:14px 8px;cursor:pointer;text-align:center}
.prn-card.active{border-color:var(--primary);background:var(--primary-light)}
.prn-icon{font-size:1.5rem;margin-bottom:6px}
.prn-name{font-weight:700;font-size:.8rem}
.prn-indication{font-size:.65rem;color:var(--text-muted)}
.prn-details{display:none;margin-top:16px;padding:16px;background:var(--bg);border-radius:12px;border:1px solid var(--border)}
.prn-details.visible{display:block}
.prn-dose-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px}
.prn-dose-row:last-child{border-bottom:none}
.prn-dose-label{font-size:.85rem;color:var(--text-secondary)}
.prn-dose-value{font-weight:600;font-size:.9rem}
.prn-warning{margin-top:12px;padding:10px;background:var(--warning-light);border-radius:8px;font-size:.8rem;color:var(--warning)}
.prn-danger{margin-top:12px;padding:10px;background:var(--danger-light);border-radius:8px;font-size:.8rem;color:var(--danger)}
.ai-section{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:12px}
.ai-header{padding:16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}
.ai-icon{width:44px;height:44px;background:linear-gradient(135deg,#0f766e,#115e59);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem}
.ai-title{font-weight:700;font-size:1rem}
.ai-subtitle{font-size:.8rem;color:var(--text-muted)}
.ai-body{padding:16px}
.ai-prompts{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.ai-prompt-btn{padding:8px 14px;background:var(--bg);border:1px solid var(--border);border-radius:20px;font-size:.75rem;font-weight:500;color:var(--text-secondary);cursor:pointer}
.ai-input-row{display:flex;gap:10px}
.ai-input{flex:1;min-width:0;padding:14px 16px;border:1px solid var(--border);border-radius:12px;font-size:16px;background:var(--bg);color:var(--text)}
.ai-send-btn{width:48px;height:48px;border-radius:12px;background:var(--primary);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}
.ai-response{display:none;margin-top:16px;background:var(--bg);border:1px solid var(--border);border-radius:12px;overflow:hidden}
.ai-response.visible{display:block}
.ai-response-header{padding:12px 16px;background:var(--primary-light);border-bottom:1px solid var(--border);display:flex;justify-content:space-between}
.ai-response-label{font-size:.75rem;font-weight:600;color:var(--primary);text-transform:uppercase}
.ai-response-time{font-size:.75rem;color:var(--text-muted)}
.ai-response-body{padding:16px;font-size:.9rem;line-height:1.8;max-height:50vh;overflow-y:auto}
.ai-alert{padding:12px;border-radius:10px;margin:12px 0;display:flex;align-items:flex-start;gap:10px}
.ai-alert.danger{background:var(--danger-light);border:1px solid var(--danger)}
.ai-alert-icon{font-size:1.1rem}
.ai-alert-content{font-size:.85rem;line-height:1.5}
.ai-alert.danger .ai-alert-content{color:var(--danger)}
.ai-loading{display:flex;align-items:center;justify-content:center;gap:12px;padding:30px;color:var(--text-muted)}
.ai-loading-spinner{width:24px;height:24px;border:3px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.quick-ref-section{margin-top:24px}
.section-label{font-size:.75rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;margin-bottom:12px}
.quick-ref-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
@media(max-width:500px){.quick-ref-grid{grid-template-columns:repeat(2,1fr)}}
.quick-ref-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer}
.quick-ref-icon{font-size:1.3rem;margin-bottom:6px}
.quick-ref-title{font-weight:600;font-size:.8rem;margin-bottom:2px}
.quick-ref-value{font-size:.7rem;color:var(--text-muted)}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg-card);border-top:1px solid var(--border);padding:8px 16px;padding-bottom:calc(8px + env(safe-area-inset-bottom));display:flex;justify-content:space-around;z-index:1000}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 16px;border-radius:12px;cursor:pointer;color:var(--text-muted);font-size:.7rem;font-weight:600}
.nav-item.active{color:var(--primary);background:var(--primary-light)}
.nav-icon{font-size:1.3rem}
.hidden{display:none!important}
</style>
</head>
<body>
<header class="app-header">
<div class="header-row">
<div class="header-brand">
<div class="header-logo">ü©∫</div>
<div><div class="header-title">OnCall Assistant</div><div class="header-subtitle">Evidence-Based Decision Support</div></div>
</div>
<div class="header-actions">
<button class="icon-btn" onclick="toggleTheme()" id="themeBtn">üåô</button>
<button class="icon-btn" onclick="goBack()">‚úï</button>
</div>
</div>
</header>
<div class="main-content">
<div class="category-pills">
<button class="pill active" onclick="filterCategory('all')">All Tools</button>
<button class="pill" onclick="filterCategory('emergency')">üö® Emergency</button>
<button class="pill" onclick="filterCategory('prn')">üíä PRN</button>
<button class="pill" onclick="filterCategory('lytes')">üß™ Lytes</button>
<button class="pill" onclick="filterCategory('renal')">ü´ò Renal</button>
<button class="pill" onclick="filterCategory('cardiac')">‚ù§Ô∏è Cardiac</button>
<button class="pill" onclick="filterCategory('vent')">ü´Å Vent</button>
</div>

<!-- HYPOGLYCEMIA -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üç¨</div>
<div><div class="tool-title">Hypoglycemia Protocol<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Glucose &lt; 3.9 mmol/L</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-group"><label class="form-label">Blood Glucose (mmol/L)</label><input type="number" class="form-input" id="inputHypoGlucose" placeholder="e.g., 2.8" step="0.1"></div>
<div class="form-group"><label class="form-label">Patient Status</label>
<select class="form-select" id="inputHypoStatus">
<option value="conscious">Conscious &amp; able to swallow</option>
<option value="confused">Confused / Drowsy</option>
<option value="unconscious">Unconscious / Seizing</option>
<option value="npo">NPO / Unable to swallow</option>
</select></div>
<button class="calc-btn danger" onclick="calcHypoglycemia()">Get Treatment Protocol</button>
<div id="resultHypo" class="result-box hidden"></div>
</div>
</div>

<!-- HYPERKALEMIA -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">‚ö°</div>
<div><div class="tool-title">Hyperkalemia Emergency<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">K+ &gt; 6.0 mmol/L treatment</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Potassium (mmol/L)</label><input type="number" class="form-input" id="inputHyperK" placeholder="e.g., 6.5" step="0.1"></div>
<div class="form-group"><label class="form-label">ECG Changes?</label>
<select class="form-select" id="inputHyperKECG">
<option value="none">None</option>
<option value="peaked">Peaked T waves</option>
<option value="wide">Widened QRS</option>
<option value="sine">Sine wave</option>
</select></div>
</div>
<button class="calc-btn danger" onclick="calcHyperkalemia()">Get Emergency Protocol</button>
<div id="resultHyperK" class="result-box hidden"></div>
</div>
</div>

<!-- ANAPHYLAXIS -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üíâ</div>
<div><div class="tool-title">Anaphylaxis Protocol<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Severe allergic reaction</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-group"><label class="form-label">Age Group</label>
<select class="form-select" id="inputAnapAge">
<option value="adult">Adult (&gt;12 years)</option>
<option value="child">Child 6-12 years</option>
<option value="infant">Child &lt;6 years</option>
</select></div>
<button class="calc-btn danger" onclick="calcAnaphylaxis()">Get Emergency Protocol</button>
<div id="resultAnap" class="result-box hidden"></div>
</div>
</div>

<!-- SEPSIS -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">ü¶†</div>
<div><div class="tool-title">Sepsis / Septic Shock<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Hour-1 Bundle (Surviving Sepsis 2021)</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Lactate (mmol/L)</label><input type="number" class="form-input" id="inputSepsisLactate" placeholder="e.g., 4.2" step="0.1"></div>
<div class="form-group"><label class="form-label">MAP (mmHg)</label><input type="number" class="form-input" id="inputSepsisMAP" placeholder="e.g., 55"></div>
</div>
<button class="calc-btn danger" onclick="calcSepsis()">Get Hour-1 Bundle</button>
<div id="resultSepsis" class="result-box hidden"></div>
</div>
</div>

<!-- ACS -->
<div class="tool-card emergency" data-category="emergency cardiac">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üíî</div>
<div><div class="tool-title">ACS / STEMI Protocol<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Acute coronary syndrome</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-group"><label class="form-label">ECG Findings</label>
<select class="form-select" id="inputACSType">
<option value="stemi">STEMI (ST elevation)</option>
<option value="nstemi">NSTEMI (Trop positive)</option>
<option value="ua">Unstable Angina</option>
</select></div>
<div class="form-row">
<div class="form-group"><label class="form-label">SBP (mmHg)</label><input type="number" class="form-input" id="inputACSSBP" placeholder="e.g., 120"></div>
<div class="form-group"><label class="form-label">HR (bpm)</label><input type="number" class="form-input" id="inputACSHR" placeholder="e.g., 80"></div>
</div>
<button class="calc-btn danger" onclick="calcACS()">Get Management Protocol</button>
<div id="resultACS" class="result-box hidden"></div>
</div>
</div>

<!-- STROKE -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üß†</div>
<div><div class="tool-title">Acute Stroke Protocol<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">tPA/Thrombectomy eligibility</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Time Since Onset</label>
<select class="form-select" id="inputStrokeTime">
<option value="0-3">0-3 hours</option>
<option value="3-4.5">3-4.5 hours</option>
<option value="4.5-6">4.5-6 hours</option>
<option value="6-24">6-24 hours</option>
</select></div>
<div class="form-group"><label class="form-label">NIHSS Score</label><input type="number" class="form-input" id="inputStrokeNIHSS" placeholder="e.g., 12"></div>
</div>
<button class="calc-btn danger" onclick="calcStroke()">Check tPA Eligibility</button>
<div id="resultStroke" class="result-box hidden"></div>
</div>
</div>

<!-- STATUS EPILEPTICUS -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">‚ö°</div>
<div><div class="tool-title">Status Epilepticus<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Seizure &gt;5 min protocol</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Weight (kg)</label><input type="number" class="form-input" id="inputSEWeight" placeholder="e.g., 70"></div>
<div class="form-group"><label class="form-label">IV Access?</label>
<select class="form-select" id="inputSEAccess">
<option value="yes">Yes</option>
<option value="no">No</option>
</select></div>
</div>
<button class="calc-btn danger" onclick="calcStatusEpilepticus()">Get Treatment Protocol</button>
<div id="resultSE" class="result-box hidden"></div>
</div>
</div>

<!-- DKA -->
<div class="tool-card emergency" data-category="emergency">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üíß</div>
<div><div class="tool-title">DKA Management<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Diabetic ketoacidosis</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">pH</label><input type="number" class="form-input" id="inputDKApH" placeholder="e.g., 7.15" step="0.01"></div>
<div class="form-group"><label class="form-label">K+ (mmol/L)</label><input type="number" class="form-input" id="inputDKAK" placeholder="e.g., 5.2" step="0.1"></div>
</div>
<button class="calc-btn danger" onclick="calcDKA()">Get DKA Protocol</button>
<div id="resultDKA" class="result-box hidden"></div>
</div>
</div>

<!-- PULMONARY EDEMA -->
<div class="tool-card emergency" data-category="emergency cardiac">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">ü´Å</div>
<div><div class="tool-title">Acute Pulmonary Edema<span class="tool-badge urgent">Urgent</span></div><div class="tool-subtitle">Acute heart failure</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">SBP (mmHg)</label><input type="number" class="form-input" id="inputAPEsbp" placeholder="e.g., 160"></div>
<div class="form-group"><label class="form-label">SpO2 (%)</label><input type="number" class="form-input" id="inputAPEspo2" placeholder="e.g., 85"></div>
</div>
<button class="calc-btn danger" onclick="calcAPE()">Get Management Protocol</button>
<div id="resultAPE" class="result-box hidden"></div>
</div>
</div>

<!-- PRN MEDICATIONS -->
<div class="tool-card" data-category="prn">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üíä</div>
<div><div class="tool-title">PRN Medications</div><div class="tool-subtitle">Common as-needed prescriptions</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="prn-grid" id="prnGrid">
<div class="prn-card" onclick="showPRN('pain')"><div class="prn-icon">üò£</div><div class="prn-name">Pain</div><div class="prn-indication">Analgesia</div></div>
<div class="prn-card" onclick="showPRN('nausea')"><div class="prn-icon">ü§¢</div><div class="prn-name">Nausea</div><div class="prn-indication">Antiemetics</div></div>
<div class="prn-card" onclick="showPRN('fever')"><div class="prn-icon">üå°Ô∏è</div><div class="prn-name">Fever</div><div class="prn-indication">Antipyretics</div></div>
<div class="prn-card" onclick="showPRN('sleep')"><div class="prn-icon">üò¥</div><div class="prn-name">Sleep</div><div class="prn-indication">Sedatives</div></div>
<div class="prn-card" onclick="showPRN('anxiety')"><div class="prn-icon">üò∞</div><div class="prn-name">Anxiety</div><div class="prn-indication">Anxiolytics</div></div>
<div class="prn-card" onclick="showPRN('constipation')"><div class="prn-icon">üí©</div><div class="prn-name">Constipation</div><div class="prn-indication">Laxatives</div></div>
<div class="prn-card" onclick="showPRN('itch')"><div class="prn-icon">üñêÔ∏è</div><div class="prn-name">Itch</div><div class="prn-indication">Antihistamines</div></div>
<div class="prn-card" onclick="showPRN('heartburn')"><div class="prn-icon">üî•</div><div class="prn-name">Heartburn</div><div class="prn-indication">Antacids/PPI</div></div>
<div class="prn-card" onclick="showPRN('agitation')"><div class="prn-icon">üò§</div><div class="prn-name">Agitation</div><div class="prn-indication">Rapid tranq</div></div>
<div class="prn-card" onclick="showPRN('hypertension')"><div class="prn-icon">üìà</div><div class="prn-name">Hypertension</div><div class="prn-indication">PRN BP meds</div></div>
<div class="prn-card" onclick="showPRN('bronchospasm')"><div class="prn-icon">üå¨Ô∏è</div><div class="prn-name">Wheeze</div><div class="prn-indication">Bronchodilators</div></div>
<div class="prn-card" onclick="showPRN('diarrhea')"><div class="prn-icon">üöΩ</div><div class="prn-name">Diarrhea</div><div class="prn-indication">Antidiarrheals</div></div>
</div>
<div id="prnDetails" class="prn-details"></div>
</div>
</div>

<!-- POTASSIUM -->
<div class="tool-card" data-category="lytes">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">üß™</div>
<div><div class="tool-title">Potassium Correction</div><div class="tool-subtitle">IV/PO KCl dosing</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-group"><label class="form-label">Current K+ (mmol/L)</label><input type="number" class="form-input" id="inputK" placeholder="e.g., 3.2" step="0.1"></div>
<button class="calc-btn" onclick="calcPotassium()">Calculate Replacement</button>
<div id="resultK" class="result-box hidden"></div>
</div>
</div>

<!-- CALCIUM -->
<div class="tool-card" data-category="lytes">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">ü¶¥</div>
<div><div class="tool-title">Corrected Calcium</div><div class="tool-subtitle">Albumin adjustment</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Total Ca (mmol/L)</label><input type="number" class="form-input" id="inputCa" placeholder="e.g., 2.0" step="0.01"></div>
<div class="form-group"><label class="form-label">Albumin (g/L)</label><input type="number" class="form-input" id="inputAlb" placeholder="e.g., 28"></div>
</div>
<button class="calc-btn" onclick="calcCorrectedCa()">Calculate</button>
<div id="resultCa" class="result-box hidden"></div>
</div>
</div>

<!-- eGFR -->
<div class="tool-card" data-category="renal">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">ü´ò</div>
<div><div class="tool-title">eGFR Calculator</div><div class="tool-subtitle">CKD-EPI 2021</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">Creatinine (¬µmol/L)</label><input type="number" class="form-input" id="inputCr" placeholder="e.g., 120"></div>
<div class="form-group"><label class="form-label">Age (years)</label><input type="number" class="form-input" id="inputAge" placeholder="e.g., 65"></div>
</div>
<div class="form-group"><label class="form-label">Sex</label>
<div class="gender-buttons">
<button class="gender-btn" onclick="setEGFRSex('m',this)">‚ôÇÔ∏è Male</button>
<button class="gender-btn" onclick="setEGFRSex('f',this)">‚ôÄÔ∏è Female</button>
</div></div>
<button class="calc-btn" onclick="calcEGFR()">Calculate eGFR</button>
<div id="resultEGFR" class="result-box hidden"></div>
</div>
</div>

<!-- QTc -->
<div class="tool-card" data-category="cardiac">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">‚ù§Ô∏è</div>
<div><div class="tool-title">QTc Calculator</div><div class="tool-subtitle">Bazett formula</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-row">
<div class="form-group"><label class="form-label">QT Interval (ms)</label><input type="number" class="form-input" id="inputQT" placeholder="e.g., 400"></div>
<div class="form-group"><label class="form-label">Heart Rate (bpm)</label><input type="number" class="form-input" id="inputHR" placeholder="e.g., 80"></div>
</div>
<button class="calc-btn" onclick="calcQTc()">Calculate QTc</button>
<div id="resultQTc" class="result-box hidden"></div>
</div>
</div>

<!-- VENT -->
<div class="tool-card" data-category="vent">
<div class="tool-header" onclick="toggleTool(this)">
<div class="tool-header-left">
<div class="tool-icon">ü´Å</div>
<div><div class="tool-title">Ventilator Settings</div><div class="tool-subtitle">ARDSNet Protocol</div></div>
</div>
<div class="tool-chevron">‚ñº</div>
</div>
<div class="tool-content">
<div class="tool-divider"></div>
<div class="form-group"><label class="form-label">Height (cm)</label><input type="number" class="form-input" id="inputHeight" placeholder="e.g., 175"></div>
<div class="form-group"><label class="form-label">Sex</label>
<div class="gender-buttons">
<button class="gender-btn" onclick="setGender('m',this)">‚ôÇÔ∏è Male</button>
<button class="gender-btn" onclick="setGender('f',this)">‚ôÄÔ∏è Female</button>
</div></div>
<button class="calc-btn" onclick="calcVent()">Calculate Tidal Volume</button>
<div id="resultVent" class="result-box hidden"></div>
</div>
</div>

<!-- AI ASSISTANT -->
<div class="ai-section" data-category="ai">
<div class="ai-header">
<div class="ai-icon">ü§ñ</div>
<div><div class="ai-title">Clinical AI Assistant</div><div class="ai-subtitle">Powered by Claude ‚Ä¢ Kuwait SI Units</div></div>
</div>
<div class="ai-body">
<div class="ai-prompts">
<button class="ai-prompt-btn" onclick="setAIPrompt('Hyperkalemia ECG changes')">Hyperkalemia ECG</button>
<button class="ai-prompt-btn" onclick="setAIPrompt('DKA management protocol')">DKA Protocol</button>
<button class="ai-prompt-btn" onclick="setAIPrompt('Neutropenic fever workup')">Neutropenic Fever</button>
<button class="ai-prompt-btn" onclick="setAIPrompt('Causes of SIADH')">SIADH Causes</button>
<button class="ai-prompt-btn" onclick="setAIPrompt('Acute pancreatitis management')">Pancreatitis</button>
<button class="ai-prompt-btn" onclick="setAIPrompt('GI bleed workup')">GI Bleed</button>
</div>
<div class="ai-input-row">
<input type="text" class="ai-input" id="aiInput" placeholder="Ask a clinical question...">
<button class="ai-send-btn" onclick="askClaude()">
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
</button>
</div>
<div class="ai-response" id="aiResponse"></div>
</div>
</div>

<!-- QUICK REFERENCE -->
<div class="quick-ref-section">
<div class="section-label">Quick Reference ‚Ä¢ Kuwait SI Units</div>
<div class="quick-ref-grid">
<div class="quick-ref-card" onclick="showRef('K+: 3.5-5.0 mmol/L\nCritical: <2.5 or >6.0')"><div class="quick-ref-icon">üß™</div><div class="quick-ref-title">K+</div><div class="quick-ref-value">3.5-5.0</div></div>
<div class="quick-ref-card" onclick="showRef('Na+: 136-145 mmol/L\nMax correction: 8-10 mEq/24hr')"><div class="quick-ref-icon">üßÇ</div><div class="quick-ref-title">Na+</div><div class="quick-ref-value">136-145</div></div>
<div class="quick-ref-card" onclick="showRef('Mg: 0.7-1.0 mmol/L\nCritical: <0.4')"><div class="quick-ref-icon">üíé</div><div class="quick-ref-title">Mg</div><div class="quick-ref-value">0.7-1.0</div></div>
<div class="quick-ref-card" onclick="showRef('Ca: 2.1-2.6 mmol/L\nFormula: Ca + 0.02√ó(40-Alb)')"><div class="quick-ref-icon">ü¶¥</div><div class="quick-ref-title">Ca</div><div class="quick-ref-value">2.1-2.6</div></div>
<div class="quick-ref-card" onclick="showRef('Glucose: 3.9-5.6 mmol/L\nHypoglycemia: <3.9')"><div class="quick-ref-icon">üç¨</div><div class="quick-ref-title">Glucose</div><div class="quick-ref-value">3.9-5.6</div></div>
<div class="quick-ref-card" onclick="showRef('Hgb: M 130-175 g/L\nF 120-160 g/L')"><div class="quick-ref-icon">ü©∏</div><div class="quick-ref-title">Hgb</div><div class="quick-ref-value">130-175</div></div>
<div class="quick-ref-card" onclick="showRef('Cr: M 62-106 ¬µmol/L\nF 44-80 ¬µmol/L')"><div class="quick-ref-icon">ü´ò</div><div class="quick-ref-title">Cr</div><div class="quick-ref-value">62-106</div></div>
<div class="quick-ref-card" onclick="showRef('QTc: Normal <440 ms\nProlonged >470 ms\nDanger >500 ms')"><div class="quick-ref-icon">‚ù§Ô∏è</div><div class="quick-ref-title">QTc</div><div class="quick-ref-value">&lt;440 ms</div></div>
</div>
</div>
</div>

<nav class="bottom-nav">
<div class="nav-item" onclick="goBack()"><div class="nav-icon">üè†</div><span>Home</span></div>
<div class="nav-item active"><div class="nav-icon">‚ö°</div><span>OnCall</span></div>
<div class="nav-item" onclick="filterCategory('emergency')"><div class="nav-icon">üö®</div><span>Emergency</span></div>
<div class="nav-item" onclick="scrollToAI()"><div class="nav-icon">ü§ñ</div><span>AI</span></div>
</nav>

<script>
var apiUrl='https://script.google.com/macros/s/AKfycbznXa9YNna26Srt1eZVEnSV-dIiubFLTwg3ryLdE-maGNCQhydP_8E6AK4QPXkeQrw7lA/exec';
var selectedGender='';
var selectedEGFRSex='';

function toggleTheme(){var h=document.documentElement;var n=h.getAttribute('data-theme')==='dark'?'light':'dark';h.setAttribute('data-theme',n);localStorage.setItem('oncall-theme',n);document.getElementById('themeBtn').textContent=n==='dark'?'‚òÄÔ∏è':'üåô';}
(function(){var s=localStorage.getItem('oncall-theme')||'light';document.documentElement.setAttribute('data-theme',s);setTimeout(function(){document.getElementById('themeBtn').textContent=s==='dark'?'‚òÄÔ∏è':'üåô';},0);})();
function goBack(){window.history.back();}
function scrollToAI(){document.querySelector('.ai-section').scrollIntoView({behavior:'smooth'});}
function filterCategory(cat){document.querySelectorAll('.pill').forEach(function(p){p.classList.remove('active');});if(event&&event.target)event.target.classList.add('active');document.querySelectorAll('.tool-card,.ai-section').forEach(function(c){var cats=c.dataset.category?c.dataset.category.split(' '):[];c.style.display=(cat==='all'||cats.indexOf(cat)>=0)?'block':'none';});}
function toggleTool(h){if(event&&['INPUT','BUTTON','SELECT'].indexOf(event.target.tagName)>=0)return;h.closest('.tool-card').classList.toggle('expanded');}
function setGender(g,btn){if(event)event.stopPropagation();selectedGender=g;btn.parentElement.querySelectorAll('.gender-btn').forEach(function(b){b.classList.remove('selected');});btn.classList.add('selected');}
function setEGFRSex(s,btn){if(event)event.stopPropagation();selectedEGFRSex=s;btn.parentElement.querySelectorAll('.gender-btn').forEach(function(b){b.classList.remove('selected');});btn.classList.add('selected');}

function calcHypoglycemia(){if(event)event.stopPropagation();var g=parseFloat(document.getElementById('inputHypoGlucose').value);var s=document.getElementById('inputHypoStatus').value;var box=document.getElementById('resultHypo');if(!g)return alert('Enter glucose level');box.classList.remove('hidden','danger','warning','success');if(g>=3.9){box.classList.add('success');box.innerHTML='<div class="result-title">‚úì Normal Glucose</div><div class="result-content">Glucose '+g+' mmol/L is within normal range.</div>';return;}if(s==='unconscious'||s==='npo'){box.classList.add('danger');box.innerHTML='<div class="result-title">üö® SEVERE - IV Treatment</div><div class="result-content"><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Immediate</div></div><div class="protocol-content"><strong>D50 25-50mL IV</strong> or Glucagon 1mg IM</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Recheck 15 min</div></div><div class="protocol-content">Repeat if still &lt;3.9. Consider D10 infusion.</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Investigate</div></div><div class="protocol-content">Review insulin/OHA. Consider sulfonylurea overdose.</div></div></div>';}else if(s==='confused'){box.classList.add('warning');box.innerHTML='<div class="result-title">‚ö†Ô∏è Moderate</div><div class="result-content"><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Try Oral</div></div><div class="protocol-content"><strong>Glucose gel 15-20g</strong> buccal if safe</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">If No Response</div></div><div class="protocol-content"><strong>D50 25mL IV</strong> or Glucagon 1mg IM</div></div></div>';}else{box.innerHTML='<div class="result-title">üìã Mild - Oral</div><div class="result-content"><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Fast Carbs 15-20g</div></div><div class="protocol-content">3-4 glucose tabs, 150mL juice, 1 tbsp honey</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Rule of 15</div></div><div class="protocol-content">Recheck in 15 min. Repeat if &lt;3.9</div></div></div>';}}

function calcHyperkalemia(){if(event)event.stopPropagation();var k=parseFloat(document.getElementById('inputHyperK').value);var ecg=document.getElementById('inputHyperKECG').value;var box=document.getElementById('resultHyperK');if(!k)return alert('Enter K+ level');box.classList.remove('hidden','danger','warning','success');if(k<5.5&&ecg==='none'){box.classList.add('success');box.innerHTML='<div class="result-title">‚úì Mild/No Hyperkalemia</div><div class="result-content">K+ '+k+' mmol/L. Review medications.</div>';return;}var hasECG=ecg!=='none';var severe=k>=6.5||ecg==='wide'||ecg==='sine';box.classList.add(severe?'danger':'warning');var ecgAlert=hasECG?'<div class="ai-alert danger"><div class="ai-alert-icon">‚ö°</div><div class="ai-alert-content"><strong>ECG CHANGES</strong> - Treat NOW!</div></div>':'';box.innerHTML='<div class="result-title">'+(severe?'üö® EMERGENCY':'‚ö†Ô∏è Moderate')+' K+ '+k+'</div><div class="result-content">'+ecgAlert+'<div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Stabilize</div></div><div class="protocol-content"><strong>Ca Gluconate 10% 10mL IV</strong> over 2-3 min</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Shift K+</div></div><div class="protocol-content"><strong>Insulin 10U + D50 25g IV</strong><br><strong>Salbutamol 10-20mg neb</strong></div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Remove K+</div></div><div class="protocol-content"><strong>Furosemide 40-80mg IV</strong><br>Consider dialysis</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">4</div><div class="protocol-title">Stop</div></div><div class="protocol-content">HOLD: K+ supplements, ACEi/ARBs, spironolactone</div></div></div>';}

function calcAnaphylaxis(){if(event)event.stopPropagation();var age=document.getElementById('inputAnapAge').value;var box=document.getElementById('resultAnap');box.classList.remove('hidden','danger','warning','success');box.classList.add('danger');var epiDose=age==='adult'?'0.5mg (0.5mL 1:1000)':age==='child'?'0.3mg (0.3mL 1:1000)':'0.15mg (0.15mL 1:1000)';box.innerHTML='<div class="result-title">üö® ANAPHYLAXIS</div><div class="result-content"><div class="ai-alert danger"><div class="ai-alert-icon">üíâ</div><div class="ai-alert-content"><strong>ADRENALINE FIRST!</strong></div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">ADRENALINE</div></div><div class="protocol-content"><strong>'+epiDose+'</strong> IM thigh<br>Repeat q5min PRN</div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Position</div></div><div class="protocol-content">Lie flat, elevate legs</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">O2 + Airway</div></div><div class="protocol-content">High-flow O2 15L/min</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">4</div><div class="protocol-title">IV + Fluids</div></div><div class="protocol-content"><strong>NS 20mL/kg</strong> if hypotensive</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">5</div><div class="protocol-title">Second Line</div></div><div class="protocol-content">Hydrocortisone 200mg IV<br>Chlorpheniramine 10mg IV</div></div></div>';}

function calcSepsis(){if(event)event.stopPropagation();var lactate=parseFloat(document.getElementById('inputSepsisLactate').value);var map=parseFloat(document.getElementById('inputSepsisMAP').value);var box=document.getElementById('resultSepsis');box.classList.remove('hidden','danger','warning','success');var isShock=(map&&map<65)||(lactate&&lactate>2);box.classList.add(isShock?'danger':'warning');box.innerHTML='<div class="result-title">'+(isShock?'üö® SEPTIC SHOCK':'‚ö†Ô∏è SEPSIS')+' Hour-1 Bundle</div><div class="result-content"><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Lactate</div></div><div class="protocol-content">'+(lactate?'Current: '+lactate+' mmol/L':'Draw NOW')+'</div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Blood Cx</div></div><div class="protocol-content">2 sets BEFORE antibiotics</div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Antibiotics</div></div><div class="protocol-content"><strong>Within 1 hour</strong><br>Pip-Tazo 4.5g IV ¬± Vancomycin</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">4</div><div class="protocol-title">Fluids</div></div><div class="protocol-content"><strong>30mL/kg crystalloid</strong></div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">5</div><div class="protocol-title">Vasopressors</div></div><div class="protocol-content">If MAP &lt;65 after fluids: <strong>Norepinephrine</strong></div></div></div>';}

function calcACS(){if(event)event.stopPropagation();var type=document.getElementById('inputACSType').value;var sbp=parseFloat(document.getElementById('inputACSSBP').value);var hr=parseFloat(document.getElementById('inputACSHR').value);var box=document.getElementById('resultACS');box.classList.remove('hidden','danger','warning','success');var isSTEMI=type==='stemi';box.classList.add(isSTEMI?'danger':'warning');var canNitro=!sbp||sbp>90;var canBB=!hr||hr>60;box.innerHTML='<div class="result-title">'+(isSTEMI?'üö® STEMI':'‚ö†Ô∏è '+(type==='nstemi'?'NSTEMI':'UA'))+'</div><div class="result-content">'+(isSTEMI?'<div class="ai-alert danger"><div class="ai-alert-icon">‚è±Ô∏è</div><div class="ai-alert-content"><strong>CATH LAB</strong> D2B &lt;90min</div></div>':'')+'<div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">MONA-B</div></div><div class="protocol-content"><strong>M</strong>orphine PRN<br><strong>O</strong>xygen if SpO2&lt;94%<br><strong>N</strong>itrates '+(canNitro?'':'(HOLD)')+'<br><strong>A</strong>spirin 300mg<br><strong>B</strong>eta-blocker '+(canBB?'':'(HOLD)')+'</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Antiplatelet</div></div><div class="protocol-content"><strong>Ticagrelor 180mg</strong> or Clopidogrel 600mg</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Anticoag</div></div><div class="protocol-content"><strong>Enoxaparin 1mg/kg SC</strong></div></div></div>';}

function calcStroke(){if(event)event.stopPropagation();var time=document.getElementById('inputStrokeTime').value;var nihss=parseFloat(document.getElementById('inputStrokeNIHSS').value)||0;var box=document.getElementById('resultStroke');box.classList.remove('hidden','danger','warning','success');var canTPA=time==='0-3'||time==='3-4.5';box.classList.add(canTPA?'danger':'warning');box.innerHTML='<div class="result-title">'+(canTPA?'üö® tPA CANDIDATE':'‚ö†Ô∏è Stroke Assessment')+'</div><div class="result-content">'+(canTPA?'<div class="ai-alert danger"><div class="ai-alert-icon">‚è±Ô∏è</div><div class="ai-alert-content">tPA window 0-4.5h</div></div>':'')+'<div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Immediate</div></div><div class="protocol-content">STAT CT, glucose, CBC, coags</div></div><div class="protocol-step '+(canTPA?'danger':'warning')+'"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">tPA</div></div><div class="protocol-content">'+(canTPA?'<strong>0.9mg/kg (max 90mg)</strong><br>10% bolus, 90% over 60min':'Outside window ('+time+')')+'</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Thrombectomy</div></div><div class="protocol-content">'+(nihss>=6?'<strong>Consider</strong> NIHSS ‚â•6':'Evaluate if NIHSS ‚â•6')+'</div></div></div>';}

function calcStatusEpilepticus(){if(event)event.stopPropagation();var wt=parseFloat(document.getElementById('inputSEWeight').value)||70;var iv=document.getElementById('inputSEAccess').value;var box=document.getElementById('resultSE');box.classList.remove('hidden','danger','warning','success');box.classList.add('danger');var loraz=Math.min(4,wt*0.1).toFixed(1);var midaz=Math.min(10,wt*0.2).toFixed(0);var lev=Math.min(4500,wt*60);box.innerHTML='<div class="result-title">üö® STATUS EPILEPTICUS '+wt+'kg</div><div class="result-content"><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">0-5 min</div></div><div class="protocol-content">ABCs, O2, glucose<br>'+(iv==='yes'?'<strong>Lorazepam '+loraz+'mg IV</strong>':'<strong>Midazolam '+midaz+'mg IM</strong>')+'</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">5-20 min</div></div><div class="protocol-content"><strong>Levetiracetam '+lev+'mg IV</strong><br>OR Phenytoin 20mg/kg</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">20-40 min</div></div><div class="protocol-content">Refractory ‚Üí <strong>ICU</strong><br>Propofol/Midazolam infusion</div></div></div>';}

function calcDKA(){if(event)event.stopPropagation();var pH=parseFloat(document.getElementById('inputDKApH').value);var k=parseFloat(document.getElementById('inputDKAK').value);var box=document.getElementById('resultDKA');box.classList.remove('hidden','danger','warning','success');var severe=pH&&pH<7.0;box.classList.add(severe?'danger':'warning');var kRec='Check K+ before insulin';if(k&&k<3.3)kRec='<strong>HOLD INSULIN</strong> until K+>3.3';else if(k&&k<5.3)kRec='Add 20-30 mEq KCl/L fluid';else if(k)kRec='No K+ initially';box.innerHTML='<div class="result-title">'+(severe?'üö® SEVERE DKA':'‚ö†Ô∏è DKA')+(pH?' pH '+pH:'')+'</div><div class="result-content"><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Fluids</div></div><div class="protocol-content"><strong>NS 1-1.5L/hr</strong> x1h<br>Then 250-500mL/hr</div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Insulin</div></div><div class="protocol-content">'+(k&&k<3.3?'<span style="color:var(--danger)">HOLD until K+>3.3</span><br>':'')+'<strong>0.1 U/kg/hr</strong> infusion</div></div><div class="protocol-step warning"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Potassium</div></div><div class="protocol-content">'+kRec+'</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">4</div><div class="protocol-title">Monitor</div></div><div class="protocol-content">BG q1h, lytes q2-4h</div></div></div>';}

function calcAPE(){if(event)event.stopPropagation();var sbp=parseFloat(document.getElementById('inputAPEsbp').value);var spo2=parseFloat(document.getElementById('inputAPEspo2').value);var box=document.getElementById('resultAPE');box.classList.remove('hidden','danger','warning','success');box.classList.add('danger');var canVaso=!sbp||sbp>90;box.innerHTML='<div class="result-title">üö® PULMONARY EDEMA</div><div class="result-content"><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">1</div><div class="protocol-title">Position + O2</div></div><div class="protocol-content">Sit up, legs down<br>'+(spo2&&spo2<90?'<strong>CPAP/BiPAP</strong>':'High-flow O2')+'</div></div><div class="protocol-step danger"><div class="protocol-header"><div class="protocol-number">2</div><div class="protocol-title">Diuresis</div></div><div class="protocol-content"><strong>Furosemide 40-80mg IV</strong></div></div><div class="protocol-step '+(canVaso?'warning':'')+'"><div class="protocol-header"><div class="protocol-number">3</div><div class="protocol-title">Vasodilation</div></div><div class="protocol-content">'+(canVaso?'<strong>GTN SL/spray</strong>':'HOLD - SBP low')+'</div></div><div class="protocol-step"><div class="protocol-header"><div class="protocol-number">4</div><div class="protocol-title">Other</div></div><div class="protocol-content">Morphine 2-4mg IV PRN<br>ECG, troponin, BNP</div></div></div>';}

var prnData={
pain:{title:'üíä Pain',options:[{label:'Mild',value:'Paracetamol 1g PO/IV q6h'},{label:'Moderate',value:'Tramadol 50-100mg PO q6h'},{label:'Severe',value:'Morphine 2.5-5mg IV q4h'}],warning:'Reduce opioids in elderly/renal impairment'},
nausea:{title:'ü§¢ Nausea',options:[{label:'First Line',value:'Ondansetron 4-8mg IV/PO q8h'},{label:'Alternative',value:'Metoclopramide 10mg IV/PO q8h'}],warning:'Metoclopramide: avoid in obstruction, max 5 days'},
fever:{title:'üå°Ô∏è Fever',options:[{label:'First Line',value:'Paracetamol 1g PO/IV q6h (max 4g/day)'},{label:'Alternative',value:'Ibuprofen 400mg PO q6-8h'}],warning:'Avoid NSAIDs in renal/GI/HF'},
sleep:{title:'üò¥ Sleep',options:[{label:'First Line',value:'Melatonin 3-5mg PO hs'},{label:'Short-term',value:'Zopiclone 3.75-7.5mg PO hs'}],warning:'Avoid benzos in elderly'},
anxiety:{title:'üò∞ Anxiety',options:[{label:'Mild',value:'Hydroxyzine 25-50mg PO q6h'},{label:'Moderate',value:'Lorazepam 0.5-1mg PO/SL q6h'}],warning:'Benzos can worsen delirium'},
constipation:{title:'üí© Constipation',options:[{label:'First Line',value:'Lactulose 15-30mL PO BD'},{label:'Stimulant',value:'Senna 15mg PO hs'},{label:'Severe',value:'Bisacodyl 10mg PR + enema'}],warning:'Rule out obstruction first'},
itch:{title:'üñêÔ∏è Itch',options:[{label:'Non-sedating',value:'Cetirizine 10mg PO daily'},{label:'Sedating',value:'Chlorpheniramine 4mg PO q6h'}],warning:'Sedating in elderly'},
heartburn:{title:'üî• Heartburn',options:[{label:'Immediate',value:'Gaviscon 10-20mL PRN'},{label:'PPI',value:'Omeprazole 20-40mg PO daily'}],warning:'Long-term PPI risks'},
agitation:{title:'üò§ Agitation',options:[{label:'Verbal first!',value:''},{label:'PO',value:'Olanzapine 5-10mg OR Lorazepam 1-2mg'},{label:'IM',value:'Haloperidol 5mg + Lorazepam 2mg IM'}],danger:'NEVER IM olanzapine with benzos'},
hypertension:{title:'üìà HTN',options:[{label:'Mild',value:'Amlodipine 5mg PO'},{label:'Moderate',value:'Labetalol 100-200mg PO'},{label:'Severe',value:'Labetalol 20mg IV q10min'}],warning:'Rule out emergency first'},
bronchospasm:{title:'üå¨Ô∏è Wheeze',options:[{label:'First Line',value:'Salbutamol 2.5-5mg neb q20min x3'},{label:'Add',value:'Ipratropium 500mcg neb'},{label:'Systemic',value:'Hydrocortisone 100mg IV'}],warning:'Continuous nebs if severe'},
diarrhea:{title:'üöΩ Diarrhea',options:[{label:'Rehydrate first!',value:'ORS or IV fluids'},{label:'Non-infective',value:'Loperamide 4mg then 2mg PRN'}],danger:'AVOID if bloody/fever/C.diff'}
};

function showPRN(type){var data=prnData[type];var det=document.getElementById('prnDetails');document.querySelectorAll('.prn-card').forEach(function(c){c.classList.remove('active');});event.target.closest('.prn-card').classList.add('active');var html='<div style="font-weight:700;font-size:1rem;margin-bottom:12px;">'+data.title+'</div>';data.options.forEach(function(opt){if(opt.value){html+='<div class="prn-dose-row"><div class="prn-dose-label">'+opt.label+'</div><div class="prn-dose-value">'+opt.value+'</div></div>';}else{html+='<div style="font-weight:600;color:var(--primary);margin:8px 0;">'+opt.label+'</div>';}});if(data.danger)html+='<div class="prn-danger">‚ö†Ô∏è '+data.danger+'</div>';if(data.warning)html+='<div class="prn-warning">üí° '+data.warning+'</div>';det.innerHTML=html;det.classList.add('visible');}

function setAIPrompt(t){document.getElementById('aiInput').value=t;document.getElementById('aiInput').focus();}

function askClaude(){var input=document.getElementById('aiInput');var resp=document.getElementById('aiResponse');var q=input.value.trim();if(!q)return alert('Enter a question');resp.classList.add('visible');resp.innerHTML='<div class="ai-response-header"><span class="ai-response-label">Loading...</span></div><div class="ai-response-body"><div class="ai-loading"><div class="ai-loading-spinner"></div><span>Analyzing...</span></div></div>';fetch(apiUrl,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({action:'oncallAskClinical',question:q})}).then(function(r){return r.json();}).then(function(d){if(d.error)throw new Error(d.error);var ans=d.answer||d.response||'No response';ans=ans.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');resp.innerHTML='<div class="ai-response-header"><span class="ai-response-label">Response</span><span class="ai-response-time">'+new Date().toLocaleTimeString()+'</span></div><div class="ai-response-body">'+ans+'</div>';input.value='';}).catch(function(e){resp.innerHTML='<div class="ai-response-header"><span class="ai-response-label" style="color:var(--danger)">Error</span></div><div class="ai-response-body"><div class="ai-alert danger"><div class="ai-alert-icon">‚ö†Ô∏è</div><div class="ai-alert-content">'+(e.message||'Failed')+'</div></div></div>';});}

function showRef(text){var m=document.getElementById('refModal');if(m)m.remove();var dark=document.documentElement.getAttribute('data-theme')==='dark';var modal=document.createElement('div');modal.id='refModal';modal.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;';modal.innerHTML='<div style="background:'+(dark?'#1e293b':'white')+';border-radius:16px;padding:24px;max-width:320px;width:100%;"><div style="font-weight:700;margin-bottom:16px;color:'+(dark?'#2dd4bf':'#0f766e')+';">üìö Reference</div><div style="font-size:0.9rem;line-height:1.7;white-space:pre-line;padding:16px;background:'+(dark?'#334155':'#f8fafc')+';border-radius:12px;">'+text+'</div><button onclick="this.closest(\'#refModal\').remove()" style="width:100%;margin-top:16px;padding:14px;background:'+(dark?'#2dd4bf':'#0f766e')+';color:'+(dark?'#0f172a':'white')+';border:none;border-radius:10px;font-weight:600;cursor:pointer;">OK</button></div>';modal.onclick=function(e){if(e.target===modal)modal.remove();};document.body.appendChild(modal);}

document.getElementById('aiInput').addEventListener('keydown',function(e){if(e.key==='Enter')askClaude();});
</script>
</body>
</html>

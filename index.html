<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="theme-color" content="#030712">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Medical Wards Pro | Clinical Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#030712; --bg-card:#0a0f1a; --bg-elevated:#111827; --bg-hover:#1f2937;
  --text:#f9fafb; --text-secondary:#9ca3af; --text-muted:#6b7280;
  --gold:#f59e0b; --gold-light:#fbbf24; --teal:#14b8a6; --purple:#8b5cf6;
  --rose:#f43f5e; --emerald:#10b981; --blue:#3b82f6; --orange:#f97316;
  --border:rgba(255,255,255,0.08); --border-light:rgba(255,255,255,0.12);
  --glass:rgba(10,15,26,0.9); --radius:16px; --radius-sm:10px;
  --font:'Outfit',system-ui,sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:var(--font);background:var(--bg);color:var(--text)}
::-webkit-scrollbar{display:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LANDING PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#landing{height:100%;display:flex;flex-direction:column;position:relative;overflow-y:auto;z-index:1}
.landing-bg{position:absolute;inset:0;overflow:hidden;z-index:0}
.landing-bg::before{
  content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
  background:conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(245,158,11,0.03) 60deg, transparent 120deg, rgba(20,184,166,0.03) 180deg);
  animation:slowSpin 60s linear infinite;
}
@keyframes slowSpin{to{transform:rotate(360deg)}}
.floating-orb{position:absolute;border-radius:50%;filter:blur(80px);animation:floatOrb 20s ease-in-out infinite;opacity:0.4}
.floating-orb.orb-1{width:400px;height:400px;background:linear-gradient(135deg,var(--gold),var(--orange));top:-200px;right:-100px}
@keyframes floatOrb{0%,100%{transform:translate(0,0) scale(1)} 50%{transform:translate(20px,-30px) scale(0.95)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• UI COMPONENTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{display:none;height:100%;flex-direction:column}
.page.active{display:flex}
.brand-icon{width:48px;height:48px;background:linear-gradient(135deg,var(--gold),var(--orange));border-radius:14px;display:grid;place-items:center;box-shadow:0 8px 24px rgba(245,158,11,0.3)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 20px;border:none;border-radius:var(--radius-sm);font-weight:600;cursor:pointer;transition:0.2s}
.btn-primary{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:#000}
.btn-secondary{background:var(--bg-elevated);border:1px solid var(--border-light);color:var(--text)}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;margin-bottom:12px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PATIENT LIST & PROFILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.patient-card{border-left:4px solid var(--teal);transition:0.2s;cursor:pointer}
.patient-card:hover{transform:translateX(5px);border-color:var(--gold)}
.patient-card.critical{border-left-color:var(--rose)}
.vitals-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:12px;margin-top:15px}
.vital-box{background:var(--bg);padding:15px;border-radius:12px;text-align:center;border:1px solid var(--border)}
.vital-val{font-size:1.4rem;font-weight:800;color:var(--teal)}
.profile-tab{padding:12px 20px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--text-muted);cursor:pointer}
.profile-tab.active{color:var(--gold);border-bottom-color:var(--gold)}

/* Fluids & Labs Component */
.fluid-stat{text-align:center; flex:1; padding:10px; border-radius:10px; background:rgba(255,255,255,0.03)}
.fluid-val{font-size:1.5rem; font-weight:800; display:block}
.fluid-val.intake{color:var(--blue)}
.fluid-val.output{color:var(--orange)}
.fluid-val.net{color:var(--emerald)}

.lab-grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:10px; margin-top:15px}
.lab-card{background:var(--bg); padding:12px; border-radius:10px; border:1px solid var(--border); position:relative}
.lab-card.alert-critical{border-color:var(--rose); background:rgba(244, 63, 94, 0.05)}
.lab-tag{font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; display:block}
.lab-val{font-size:1.2rem; font-weight:800; color:var(--text)}
.lab-val.critical{color:var(--rose)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:1000}
.modal.active{display:flex}
.modal-content{background:var(--bg-card);border:1px solid var(--border);border-radius:20px;width:90%;max-width:550px;max-height:85vh;overflow-y:auto;padding:25px}
input, select, textarea {width:100%; padding:12px; background:var(--bg); border:1px solid var(--border); border-radius:8px; color:white; margin-bottom:15px}
</style>
</head>
<body>

<div class="page active" id="landing">
  <div class="landing-bg"><div class="floating-orb orb-1"></div></div>
  <header style="padding:24px; display:flex; justify-content:space-between; z-index:10">
    <div style="display:flex; align-items:center; gap:12px"><div class="brand-icon">ğŸ¥</div><h2>Medical Wards Pro</h2></div>
    <button class="btn btn-secondary" onclick="app.nav('admin')">âš™ï¸ Admin</button>
  </header>
  <main style="flex:1; display:flex; flex-direction:column; align-items:center; padding:40px; z-index:10">
    <h1 style="font-size:3.5rem; margin-bottom:40px">Clinical <span style="color:var(--gold)">Intelligence</span></h1>
    <div id="unitsGrid" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:20px; width:100%; max-width:900px"></div>
  </main>
</div>

<div class="page" id="dashboard">
  <header style="padding:16px; background:var(--bg-card); display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border)">
    <div style="display:flex; align-items:center; gap:10px">
        <button class="btn btn-secondary" onclick="app.nav('landing')">â†</button>
        <h3 id="currentUnitTitle">Unit</h3>
    </div>
    <div style="display:flex; gap:10px">
        <button class="btn btn-secondary" onclick="app.openModal('modal-import')">ğŸ“¥ Import</button>
        <button class="btn btn-primary" onclick="app.openPtModal()">+ Patient</button>
    </div>
  </header>
  <div style="padding:20px; overflow-y:auto" id="patientsList"></div>
</div>

<div class="page" id="profile">
    <header style="padding:20px; background:var(--bg-elevated); border-bottom:1px solid var(--border)">
        <div style="display:flex; justify-content:space-between; align-items:start">
            <button class="btn btn-secondary btn-sm" onclick="app.nav('dashboard')">â† Rounds</button>
            <button class="btn btn-primary btn-sm" onclick="app.generateHandover()">ğŸ“‹ Handover</button>
        </div>
        <div id="profileHeader" style="margin-top:20px"></div>
    </header>
    <div style="display:flex; background:var(--bg-card); overflow-x:auto" id="profileTabs">
        <button class="profile-tab active" data-tab="overview" onclick="app.switchProfileTab(this)">Overview</button>
        <button class="profile-tab" data-tab="plans" onclick="app.switchProfileTab(this)">Clinical Plans</button>
        <button class="profile-tab" data-tab="fluids" onclick="app.switchProfileTab(this)">Fluid Chart</button>
        <button class="profile-tab" data-tab="labs" onclick="app.switchProfileTab(this)">Labs</button>
    </div>
    <div style="padding:20px; flex:1; overflow-y:auto" id="profileBody"></div>
</div>

<div class="modal" id="modal-pt">
    <div class="modal-content">
        <h3>Patient Admission</h3>
        <input type="text" id="f-name" placeholder="Full Name">
        <input type="text" id="f-room" placeholder="Room/Bed">
        <textarea id="f-dx" placeholder="Diagnosis/History" style="height:100px"></textarea>
        <select id="f-status"><option value="stable">Stable</option><option value="critical">Critical</option></select>
        <button class="btn btn-primary" style="width:100%" onclick="app.savePt()">Save to Records</button>
        <button class="btn btn-secondary" style="width:100%; margin-top:10px" onclick="app.closeModal()">Cancel</button>
    </div>
</div>

<div class="modal" id="modal-handover">
    <div class="modal-content">
        <h3>Clinical Handover (SBAR)</h3>
        <textarea id="handover-text" style="height:300px; font-family:'JetBrains Mono', monospace; font-size:0.85rem; margin-top:15px"></textarea>
        <button class="btn btn-primary" style="width:100%" onclick="app.copyHandover()">ğŸ“‹ Copy to Clipboard</button>
        <button class="btn btn-secondary" style="width:100%; margin-top:10px" onclick="app.closeModal()">Close</button>
    </div>
</div>

<script>
const LAB_REF = {
    'K+': {min: 3.5, max: 5.1, unit: 'mEq/L'},
    'Na+': {min: 135, max: 145, unit: 'mEq/L'},
    'Hb': {min: 12.0, max: 17.0, unit: 'g/dL'},
    'WBC': {min: 4.0, max: 11.0, unit: 'x10^9/L'},
    'Plt': {min: 150, max: 450, unit: 'x10^9/L'},
    'Cr': {min: 0.6, max: 1.2, unit: 'mg/dL'}
};

const app = {
    state: {
        units: [{id: 1, name: 'Internal Medicine', code: '1234', icon: 'ğŸ¥'}],
        patients: [],
        currentUnit: null,
        currentPt: null,
        cfg: { apiKey: '' }
    },

    init() {
        this.load();
        this.renderUnits();
    },

    nav(page) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page).classList.add('active');
        if(page === 'dashboard') this.renderPts();
    },

    selectUnit(id) {
        const u = this.state.units.find(x => x.id === id);
        if(prompt(`Enter ${u.name} Code:`) === u.code) {
            this.state.currentUnit = u;
            document.getElementById('currentUnitTitle').innerText = u.name;
            this.nav('dashboard');
        }
    },

    renderUnits() {
        document.getElementById('unitsGrid').innerHTML = this.state.units.map(u => `
            <div class="card" style="text-align:center; cursor:pointer" onclick="app.selectUnit(${u.id})">
                <div style="font-size:2.5rem">${u.icon}</div>
                <h3 style="color:var(--gold)">${u.name}</h3>
            </div>
        `).join('');
    },

    renderPts() {
        const list = document.getElementById('patientsList');
        const pts = this.state.patients.filter(p => p.unitId === this.state.currentUnit.id);
        list.innerHTML = pts.length ? pts.map(p => `
            <div class="card patient-card ${p.status === 'critical' ? 'critical' : ''}" onclick="app.openProfile(${p.id})">
                <div style="display:flex; justify-content:space-between"><strong>${p.name}</strong><small>${p.room}</small></div>
                <p style="font-size:0.85rem; color:var(--text-secondary); margin-top:5px">${p.dx}</p>
            </div>
        `).join('') : '<p style="text-align:center; padding:20px; color:var(--text-muted)">No active rounds.</p>';
    },

    openPtModal() { document.getElementById('modal-pt').classList.add('active'); },
    openModal(id) { document.getElementById(id).classList.add('active'); },
    closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); },

    savePt() {
        const pt = {
            id: Date.now(), unitId: this.state.currentUnit.id,
            name: document.getElementById('f-name').value,
            room: document.getElementById('f-room').value,
            dx: document.getElementById('f-dx').value,
            status: document.getElementById('f-status').value,
            vitals: { hr: '--', bp: '--/--', spo2: '--', temp: '--' },
            plans: [], fluids: [], labs: {}
        };
        this.state.patients.push(pt);
        this.save(); this.closeModal(); this.renderPts();
    },

    openProfile(id) {
        this.state.currentPt = this.state.patients.find(x => x.id === id);
        const p = this.state.currentPt;
        document.getElementById('profileHeader').innerHTML = `<h2 style="color:var(--gold)">${p.name}</h2><p>${p.room} | ${p.status.toUpperCase()}</p>`;
        this.nav('profile');
        this.renderOverview();
    },

    switchProfileTab(btn) {
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        const tab = btn.dataset.tab;
        if(tab === 'overview') this.renderOverview();
        if(tab === 'plans') this.renderPlans();
        if(tab === 'fluids') this.renderFluids();
        if(tab === 'labs') this.renderLabs();
    },

    renderOverview() {
        const p = this.state.currentPt;
        document.getElementById('profileBody').innerHTML = `
            <h4>Quick Assessment</h4>
            <div class="vitals-grid">
                <div class="vital-box"><div class="vital-val">${p.vitals.hr}</div><div class="vital-lbl">HR</div></div>
                <div class="vital-box"><div class="vital-val">${p.vitals.bp}</div><div class="vital-lbl">BP</div></div>
                <div class="vital-box"><div class="vital-val">${p.vitals.spo2}%</div><div class="vital-lbl">SpO2</div></div>
            </div>
            <button class="btn btn-secondary" style="width:100%; margin-top:20px" onclick="app.updateVitals()">âœï¸ Update Vitals</button>
        `;
    },

    renderPlans() {
        const p = this.state.currentPt;
        document.getElementById('profileBody').innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center"><h4>Management Strategy</h4><button class="btn btn-primary btn-sm" onclick="app.addPlan()">+ Entry</button></div>
            <div style="margin-top:15px">${p.plans.map(pl => `<div class="card" style="font-size:0.9rem">${pl}</div>`).join('')}</div>
        `;
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LAB ALERTS COMPONENT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    renderLabs() {
        const p = this.state.currentPt;
        let labHtml = '';
        for (const [key, ref] of Object.entries(LAB_REF)) {
            const val = p.labs[key] || '--';
            const isCritical = val !== '--' && (val < ref.min || val > ref.max);
            labHtml += `
                <div class="lab-card ${isCritical ? 'alert-critical' : ''}" onclick="app.updateLab('${key}')">
                    <span class="lab-tag">${key} (${ref.unit})</span>
                    <span class="lab-val ${isCritical ? 'critical' : ''}">${val}</span>
                    <small style="font-size:0.5rem; opacity:0.5">Ref: ${ref.min}-${ref.max}</small>
                </div>
            `;
        }
        document.getElementById('profileBody').innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center"><h4>Laboratory Alerts</h4><span style="font-size:0.7rem; color:var(--text-muted)">Tap to Update</span></div>
            <div class="lab-grid">${labHtml}</div>
        `;
    },

    updateLab(key) {
        const val = parseFloat(prompt(`Enter ${key} value:`));
        if(!isNaN(val)) {
            this.state.currentPt.labs[key] = val;
            this.save(); this.renderLabs();
        }
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PREVIOUS FEATURES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    renderFluids() {
        const p = this.state.currentPt;
        const intake = p.fluids.filter(f => f.dir === 'in').reduce((a, b) => a + b.amt, 0);
        const output = p.fluids.filter(f => f.dir === 'out').reduce((a, b) => a + b.amt, 0);
        const net = intake - output;
        document.getElementById('profileBody').innerHTML = `
            <div style="display:flex; gap:10px; margin-bottom:20px">
                <div class="fluid-stat"><span class="fluid-lbl">Intake</span><span class="fluid-val intake">${intake} mL</span></div>
                <div class="fluid-stat"><span class="fluid-lbl">Output</span><span class="fluid-val output">${output} mL</span></div>
                <div class="fluid-stat"><span class="fluid-lbl">Net Balance</span><span class="fluid-val net">${net > 0 ? '+' : ''}${net} mL</span></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px">
                <button class="btn btn-primary" onclick="app.addFluid('in')">+ Intake</button>
                <button class="btn btn-secondary" onclick="app.addFluid('out')">+ Output</button>
            </div>
            <h4>History</h4>
            <div style="margin-top:10px">${p.fluids.map(f => `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid var(--border); font-size:0.8rem"><span>${f.type}</span><span>${f.amt} mL</span></div>`).join('')}</div>
        `;
    },

    addFluid(dir) {
        const amt = parseInt(prompt(`mL:`)); const type = prompt(`Source:`);
        if(amt && type) {
            this.state.currentPt.fluids.unshift({dir, amt, type, time: new Date().toLocaleTimeString()});
            this.save(); this.renderFluids();
        }
    },

    updateVitals() {
        const hr = prompt("HR:", this.state.currentPt.vitals.hr); const bp = prompt("BP:", this.state.currentPt.vitals.bp);
        if(hr || bp) {
            this.state.currentPt.vitals.hr = hr || this.state.currentPt.vitals.hr;
            this.state.currentPt.vitals.bp = bp || this.state.currentPt.vitals.bp;
            this.save(); this.renderOverview();
        }
    },

    addPlan() {
        const entry = prompt("Entry:");
        if(entry) { this.state.currentPt.plans.unshift(`${new Date().toLocaleTimeString()}: ${entry}`); this.save(); this.renderPlans(); }
    },

    generateHandover() {
        const p = this.state.currentPt;
        const intake = p.fluids.filter(f => f.dir === 'in').reduce((a, b) => a + b.amt, 0);
        const output = p.fluids.filter(f => f.dir === 'out').reduce((a, b) => a + b.amt, 0);
        const net = intake - output;
        const text = `*CLINICAL SBAR*\nPt: ${p.name} (${p.room})\nStatus: ${p.status.toUpperCase()}\nDx: ${p.dx}\n\nAssesment:\nHR ${p.vitals.hr}, BP ${p.vitals.bp}\nNet Balance: ${net}mL\n\nRecommendation:\n${p.plans.slice(0,2).join('\n')}`;
        document.getElementById('handover-text').value = text;
        this.openModal('modal-handover');
    },

    copyHandover() {
        document.getElementById("handover-text").select();
        document.execCommand("copy");
        alert("SBAR Copied, Master Shifu!");
    },

    save() { localStorage.setItem('med_wards_v5', JSON.stringify(this.state)); },
    load() {
        const data = localStorage.getItem('med_wards_v5');
        if(data) this.state = JSON.parse(data);
    }
};

app.init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0a0f1a">
  <title>MedWard | Clinical Intelligence Platform</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{--bg:#050810;--bg2:#0c1322;--bg3:#131d2e;--text:#f0f4fc;--text2:#a0aec4;--muted:#5a6a85;--gold:#d4af37;--teal:#00d4aa;--blue:#3b82f6;--rose:#f43f5e;--purple:#8b5cf6;--border:rgba(212,175,55,0.15)}
    html{font-size:16px;-webkit-font-smoothing:antialiased}
    body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh}
    
    .header{position:fixed;top:0;left:0;right:0;height:64px;background:rgba(15,25,45,0.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:1000}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-mark{width:40px;height:40px;background:linear-gradient(135deg,#d4af37,#f0d875);border-radius:12px;display:grid;place-items:center}
    .logo-mark svg{width:24px;height:24px;stroke:#050810;stroke-width:2.5;fill:none}
    .logo-text{font-size:1.35rem;font-weight:700;background:linear-gradient(135deg,#d4af37,#f0d875);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .user-section{display:none;align-items:center;gap:12px}
    .user-section.visible{display:flex}
    .user-avatar{width:38px;height:38px;background:linear-gradient(135deg,#d4af37,#00d4aa);border-radius:50%;display:grid;place-items:center;font-weight:700;color:#050810}
    .user-name{font-weight:500;font-size:0.9rem}
    
    .screen{display:none;min-height:100vh;padding:84px 20px 40px}
    .screen.active{display:block}
    #screen-login.active{display:flex;align-items:center;justify-content:center}
    
    .login-card{width:100%;max-width:420px;background:linear-gradient(145deg,#0f1829,#0a1220);border:1px solid var(--border);border-radius:24px;padding:40px 32px;box-shadow:0 16px 64px rgba(0,0,0,0.5);position:relative}
    .login-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(135deg,#d4af37,#f0d875);border-radius:24px 24px 0 0}
    .login-badge{display:inline-flex;align-items:center;gap:6px;padding:5px 12px;background:rgba(212,175,55,0.1);border:1px solid rgba(212,175,55,0.2);border-radius:100px;font-size:0.7rem;font-weight:600;color:var(--gold);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:20px}
    .login-title{font-size:1.75rem;font-weight:700;margin-bottom:6px}
    .login-subtitle{color:var(--muted);margin-bottom:28px;font-size:0.9rem}
    .form-group{margin-bottom:20px}
    .form-label{display:block;font-size:0.75rem;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px}
    .form-input{width:100%;padding:14px 18px;background:var(--bg3);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:inherit;font-size:1rem;-webkit-appearance:none}
    .form-input:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 3px rgba(212,175,55,0.15)}
    .form-input::placeholder{color:var(--muted)}
    .btn{display:flex;align-items:center;justify-content:center;gap:10px;width:100%;padding:14px 24px;border:none;border-radius:12px;font-family:inherit;font-size:1rem;font-weight:600;cursor:pointer;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
    .btn-primary{background:linear-gradient(135deg,#d4af37,#f0d875);color:#050810;box-shadow:0 4px 20px rgba(212,175,55,0.3)}
    .btn-primary:active{transform:scale(0.98)}
    
    .container{max-width:1200px;margin:0 auto}
    .page-header{margin-bottom:24px}
    .page-title{font-size:1.5rem;font-weight:700;margin-bottom:4px}
    .page-subtitle{color:var(--muted);font-size:0.9rem}
    
    .tabs{display:flex;gap:4px;background:var(--bg3);padding:4px;border-radius:12px;margin-bottom:24px;overflow-x:auto}
    .tab{flex:1;min-width:80px;padding:12px 16px;background:transparent;border:none;border-radius:8px;color:var(--text2);font-family:inherit;font-size:0.85rem;font-weight:500;cursor:pointer;white-space:nowrap}
    .tab:hover{color:var(--text)}
    .tab.active{background:linear-gradient(135deg,#d4af37,#f0d875);color:#050810;font-weight:600}
    .tab-content{display:none}
    .tab-content.active{display:block;animation:fadeIn 0.3s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    
    .card{background:linear-gradient(145deg,#0f1829,#0a1220);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:20px}
    .card-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .card-title{display:flex;align-items:center;gap:10px;font-size:0.95rem;font-weight:600}
    .card-title svg{width:18px;height:18px;stroke:var(--gold)}
    .card-body{padding:20px}
    
    .stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
    .stat-card{background:var(--bg3);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center}
    .stat-value{font-size:2rem;font-weight:700;color:var(--gold)}
    .stat-label{font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.05em;margin-top:4px}
    
    .patients-table{width:100%;border-collapse:collapse}
    .patients-table th{text-align:left;padding:12px 16px;background:var(--bg3);font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:var(--muted);border-bottom:1px solid var(--border)}
    .patients-table td{padding:16px;border-bottom:1px solid var(--border);font-size:0.9rem}
    .patients-table tr:hover{background:rgba(212,175,55,0.03)}
    .patient-cell{display:flex;align-items:center;gap:12px}
    .patient-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#d4af37,#00d4aa);display:grid;place-items:center;font-weight:700;font-size:0.85rem;color:#050810;flex-shrink:0}
    .patient-name{font-weight:600}
    .patient-id{font-size:0.75rem;color:var(--muted)}
    .badge{display:inline-block;padding:4px 10px;border-radius:100px;font-size:0.7rem;font-weight:600;text-transform:uppercase}
    .badge-critical{background:rgba(244,63,94,0.15);color:var(--rose)}
    .badge-active{background:rgba(0,212,170,0.15);color:var(--teal)}
    .badge-stable{background:rgba(59,130,246,0.15);color:var(--blue)}
    .badge-chronic{background:rgba(139,92,246,0.15);color:var(--purple)}
    
    .empty-state{text-align:center;padding:48px 20px;color:var(--muted)}
    .empty-state svg{width:48px;height:48px;stroke:var(--muted);margin-bottom:16px;opacity:0.5}
    .loading{display:flex;align-items:center;justify-content:center;gap:12px;padding:40px;color:var(--muted)}
    .spinner{width:24px;height:24px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    
    .calc-item{background:var(--bg3);border-radius:12px;padding:16px;margin-bottom:12px}
    .calc-item-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .calc-item-num{width:28px;height:28px;background:var(--gold);border-radius:6px;display:grid;place-items:center;font-size:0.75rem;font-weight:700;color:#050810}
    .calc-item-name{font-weight:600;font-size:0.9rem}
    .calc-options{display:flex;flex-wrap:wrap;gap:8px}
    .calc-option{flex:1;min-width:70px;padding:10px;background:var(--bg2);border:1px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;transition:0.15s}
    .calc-option:hover{border-color:var(--gold)}
    .calc-option.selected{background:rgba(212,175,55,0.15);border-color:var(--gold)}
    .calc-option input{display:none}
    .calc-option-score{display:block;font-size:1.25rem;font-weight:700;color:var(--gold)}
    .calc-option-label{font-size:0.7rem;color:var(--text2)}
    .calc-result{background:var(--bg3);border-radius:12px;padding:20px;text-align:center;margin-top:20px}
    .calc-result-value{font-size:3rem;font-weight:700;color:var(--gold)}
    .calc-result-max{font-size:1rem;color:var(--muted)}
    .calc-result-label{font-size:0.8rem;color:var(--muted);margin-bottom:12px}
    .severity-badge{display:inline-block;padding:8px 16px;border-radius:100px;font-size:0.85rem;font-weight:600}
    
    .reference-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
    .reference-item{background:var(--bg3);border-left:3px solid var(--gold);border-radius:0 8px 8px 0;padding:16px}
    .reference-item h4{font-size:0.85rem;color:var(--gold);margin-bottom:8px}
    .reference-item p{font-size:0.8rem;color:var(--text2);margin:4px 0}
    
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);padding:14px 24px;background:var(--bg3);border:1px solid var(--teal);border-radius:12px;color:var(--text);font-weight:500;opacity:0;transition:0.3s;z-index:9999}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    
    @media(max-width:768px){
      .patients-table th:nth-child(n+3),.patients-table td:nth-child(n+3){display:none}
      .calc-options{flex-direction:column}
      .calc-option{min-width:100%}
      .stats-row{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <div class="logo-mark"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
      <span class="logo-text">MedWard</span>
    </div>
    <div class="user-section" id="user-section">
      <span class="user-name" id="display-name">User</span>
      <div class="user-avatar" id="display-initial">U</div>
    </div>
  </header>

  <main class="screen active" id="screen-login">
    <div class="login-card">
      <div class="login-badge"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Secure Access</div>
      <h1 class="login-title">Welcome to MedWard</h1>
      <p class="login-subtitle">Clinical Intelligence Platform</p>
      <div class="form-group">
        <label class="form-label">Your Name</label>
        <input type="text" id="input-name" class="form-input" placeholder="Enter your name" autocomplete="off">
      </div>
      <button type="button" class="btn btn-primary" id="btn-login">Continue<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button>
    </div>
  </main>

  <main class="screen" id="screen-dashboard">
    <div class="container">
      <header class="page-header">
        <h1 class="page-title">Clinical Dashboard</h1>
        <p class="page-subtitle">Welcome back, <span id="greeting-name">Doctor</span></p>
      </header>
      <div class="tabs">
        <button class="tab active" data-tab="patients">Patients</button>
        <button class="tab" data-tab="nihss">NIHSS</button>
        <button class="tab" data-tab="sedan">SEDAN</button>
        <button class="tab" data-tab="reference">Reference</button>
      </div>
      
      <div class="tab-content active" id="tab-patients">
        <div class="stats-row">
          <div class="stat-card"><div class="stat-value" id="stat-total">-</div><div class="stat-label">Total</div></div>
          <div class="stat-card"><div class="stat-value" id="stat-active">-</div><div class="stat-label">Active</div></div>
          <div class="stat-card"><div class="stat-value" id="stat-critical">-</div><div class="stat-label">Critical</div></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h2 class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Ward Patients</h2>
            <button class="btn btn-primary" style="width:auto;padding:8px 16px;font-size:0.8rem;" id="btn-refresh">Refresh</button>
          </div>
          <div class="card-body" style="padding:0;overflow-x:auto;"><div id="patients-container"><div class="loading"><div class="spinner"></div><span>Loading...</span></div></div></div>
        </div>
      </div>
      
      <div class="tab-content" id="tab-nihss">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>NIHSS Calculator</h2>
            <button class="btn btn-primary" style="width:auto;padding:8px 16px;font-size:0.8rem;" id="btn-reset-nihss">Reset</button>
          </div>
          <div class="card-body" id="nihss-calculator"></div>
        </div>
      </div>
      
      <div class="tab-content" id="tab-sedan">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg>SEDAN Score</h2>
            <button class="btn btn-primary" style="width:auto;padding:8px 16px;font-size:0.8rem;" id="btn-reset-sedan">Reset</button>
          </div>
          <div class="card-body" id="sedan-calculator"></div>
        </div>
      </div>
      
      <div class="tab-content" id="tab-reference">
        <div class="card">
          <div class="card-header"><h2 class="card-title"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>Quick Reference</h2></div>
          <div class="card-body">
            <div class="reference-grid">
              <div class="reference-item"><h4>tPA Window</h4><p><strong>IV tPA:</strong> Within 4.5 hours</p><p><strong>Thrombectomy:</strong> Up to 24h</p></div>
              <div class="reference-item"><h4>tPA Dosing</h4><p><strong>Dose:</strong> 0.9 mg/kg (max 90mg)</p><p><strong>Admin:</strong> 10% bolus, 90% over 60min</p></div>
              <div class="reference-item"><h4>BP Targets</h4><p><strong>Pre-tPA:</strong> &lt;185/110</p><p><strong>Post-tPA:</strong> &lt;180/105</p></div>
              <div class="reference-item"><h4>NIHSS Interpretation</h4><p>0: None | 1-4: Minor | 5-15: Moderate</p><p>16-20: Mod-Severe | 21+: Severe</p></div>
              <div class="reference-item"><h4>SEDAN sICH Risk</h4><p>0: 1.4% | 1: 2.9% | 2: 5.0%</p><p>3: 8.5% | 4: 12.2% | 5-6: 17-21%</p></div>
              <div class="reference-item"><h4>Contraindications</h4><p>Recent surgery (14d), Plt&lt;100k</p><p>INR&gt;1.7, Prior ICH, Active bleed</p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="toast" id="toast"></div>

  <script>
(function(){
  var API='https://script.google.com/macros/s/AKfycbx-l2xdsAHTZu7bcueN83Yz8xbCwtKbHfUSJuhIgtWVR5XyeJYh9TrfMgzznTYX4Z0kww/exec';
  var state={user:null,patients:[],nihss:{},sedan:{}};
  var $=function(id){return document.getElementById(id)};
  
  var NIHSS=[
    {id:'1a',name:'Level of Consciousness',opts:[{s:0,l:'Alert'},{s:1,l:'Drowsy'},{s:2,l:'Stuporous'},{s:3,l:'Coma'}]},
    {id:'1b',name:'LOC Questions',opts:[{s:0,l:'Both Correct'},{s:1,l:'One Correct'},{s:2,l:'Neither'}]},
    {id:'1c',name:'LOC Commands',opts:[{s:0,l:'Both Correct'},{s:1,l:'One Correct'},{s:2,l:'Neither'}]},
    {id:'2',name:'Best Gaze',opts:[{s:0,l:'Normal'},{s:1,l:'Partial'},{s:2,l:'Forced'}]},
    {id:'3',name:'Visual Fields',opts:[{s:0,l:'Normal'},{s:1,l:'Partial'},{s:2,l:'Complete'},{s:3,l:'Bilateral'}]},
    {id:'4',name:'Facial Palsy',opts:[{s:0,l:'Normal'},{s:1,l:'Minor'},{s:2,l:'Partial'},{s:3,l:'Complete'}]},
    {id:'5a',name:'Motor Arm L',opts:[{s:0,l:'No Drift'},{s:1,l:'Drift'},{s:2,l:'Some'},{s:3,l:'No Effort'},{s:4,l:'None'}]},
    {id:'5b',name:'Motor Arm R',opts:[{s:0,l:'No Drift'},{s:1,l:'Drift'},{s:2,l:'Some'},{s:3,l:'No Effort'},{s:4,l:'None'}]},
    {id:'6a',name:'Motor Leg L',opts:[{s:0,l:'No Drift'},{s:1,l:'Drift'},{s:2,l:'Some'},{s:3,l:'No Effort'},{s:4,l:'None'}]},
    {id:'6b',name:'Motor Leg R',opts:[{s:0,l:'No Drift'},{s:1,l:'Drift'},{s:2,l:'Some'},{s:3,l:'No Effort'},{s:4,l:'None'}]},
    {id:'7',name:'Limb Ataxia',opts:[{s:0,l:'Absent'},{s:1,l:'One'},{s:2,l:'Two'}]},
    {id:'8',name:'Sensory',opts:[{s:0,l:'Normal'},{s:1,l:'Mild'},{s:2,l:'Severe'}]},
    {id:'9',name:'Language',opts:[{s:0,l:'Normal'},{s:1,l:'Mild'},{s:2,l:'Severe'},{s:3,l:'Mute'}]},
    {id:'10',name:'Dysarthria',opts:[{s:0,l:'Normal'},{s:1,l:'Mild'},{s:2,l:'Severe'}]},
    {id:'11',name:'Extinction',opts:[{s:0,l:'Normal'},{s:1,l:'One'},{s:2,l:'Profound'}]}
  ];
  
  var SEDAN=[
    {id:'s',name:'Blood Glucose',letter:'S',opts:[{s:0,l:'<145'},{s:1,l:'145-216'},{s:2,l:'>216'}]},
    {id:'e',name:'Early Infarct on CT',letter:'E',opts:[{s:0,l:'No'},{s:1,l:'Yes'}]},
    {id:'d',name:'Hyperdense Artery',letter:'D',opts:[{s:0,l:'No'},{s:2,l:'Yes'}]},
    {id:'a',name:'Age',letter:'A',opts:[{s:0,l:'<75'},{s:1,l:'≥75'}]},
    {id:'n',name:'NIHSS',letter:'N',opts:[{s:0,l:'0-9'},{s:1,l:'≥10'}]}
  ];

  function showToast(m){var t=$('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},3000)}
  function getInitials(n){if(!n)return'?';var p=n.trim().split(/\s+/);return p.length>=2?(p[0][0]+p[p.length-1][0]).toUpperCase():n.substring(0,2).toUpperCase()}
  function showScreen(n){document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active')});var t=$('screen-'+n);if(t)t.classList.add('active')}

  function login(){
    var input=$('input-name'),name=input?input.value.trim():'';
    if(!name){alert('Please enter your name');if(input)input.focus();return}
    state.user={name:name,initial:name.charAt(0).toUpperCase()};
    try{localStorage.setItem('medward_user',JSON.stringify(state.user))}catch(e){}
    $('display-name').textContent=state.user.name;
    $('display-initial').textContent=state.user.initial;
    $('greeting-name').textContent='Dr. '+state.user.name;
    $('user-section').classList.add('visible');
    showScreen('dashboard');
    showToast('Welcome, Dr. '+name+'!');
    loadPatients();
  }

  function checkSession(){
    try{
      var s=localStorage.getItem('medward_user');
      if(s){state.user=JSON.parse(s);$('display-name').textContent=state.user.name;$('display-initial').textContent=state.user.initial;$('greeting-name').textContent='Dr. '+state.user.name;$('user-section').classList.add('visible');showScreen('dashboard');loadPatients()}
    }catch(e){}
  }

  function loadPatients(){
    var c=$('patients-container');
    c.innerHTML='<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
    fetch(API+'?action=list').then(function(r){return r.json()}).then(function(d){
      if(d.success&&d.patients){state.patients=d.patients;renderPatients()}
      else{c.innerHTML='<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg><p>No patients found</p></div>'}
    }).catch(function(){c.innerHTML='<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/></svg><p>Failed to load</p></div>'});
  }

  function renderPatients(){
    var c=$('patients-container');
    if(!state.patients||!state.patients.length){c.innerHTML='<div class="empty-state"><p>No patients</p></div>';updateStats();return}
    var h='<table class="patients-table"><thead><tr><th>Patient</th><th>Ward</th><th>Diagnosis</th><th>Status</th></tr></thead><tbody>';
    state.patients.forEach(function(p){
      var i=getInitials(p.name),sc='badge-active',st=p.status||'Active';
      if(st.toLowerCase()==='critical')sc='badge-critical';
      else if(st.toLowerCase()==='stable')sc='badge-stable';
      else if(st.toLowerCase()==='chronic')sc='badge-chronic';
      h+='<tr><td><div class="patient-cell"><div class="patient-avatar">'+i+'</div><div><div class="patient-name">'+(p.name||'Unknown')+'</div><div class="patient-id">MRN: '+(p.mrn||p.id||'-')+'</div></div></div></td>';
      h+='<td>'+(p.ward||'-')+(p.room?' • '+p.room:'')+'</td><td>'+(p.diagnosis||'-')+'</td><td><span class="badge '+sc+'">'+st+'</span></td></tr>';
    });
    h+='</tbody></table>';c.innerHTML=h;updateStats();
  }

  function updateStats(){
    var t=state.patients.length,a=0,cr=0;
    state.patients.forEach(function(p){var s=(p.status||'').toLowerCase();if(s==='active')a++;else if(s==='critical')cr++});
    $('stat-total').textContent=t;$('stat-active').textContent=a;$('stat-critical').textContent=cr;
  }

  function setupTabs(){
    document.querySelectorAll('.tab').forEach(function(tab){
      tab.addEventListener('click',function(){
        var id=this.getAttribute('data-tab');
        document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('active')});
        this.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(function(c){c.classList.remove('active')});
        var target=$('tab-'+id);if(target)target.classList.add('active');
      });
    });
  }

  function renderNIHSS(){
    var c=$('nihss-calculator'),h='';
    NIHSS.forEach(function(item){
      h+='<div class="calc-item"><div class="calc-item-header"><span class="calc-item-num">'+item.id+'</span><span class="calc-item-name">'+item.name+'</span></div><div class="calc-options">';
      item.opts.forEach(function(o){h+='<label class="calc-option" data-item="'+item.id+'" data-score="'+o.s+'"><input type="radio" name="n_'+item.id+'" value="'+o.s+'"><span class="calc-option-score">'+o.s+'</span><span class="calc-option-label">'+o.l+'</span></label>'});
      h+='</div></div>';
    });
    h+='<div class="calc-result"><div class="calc-result-label">Total NIHSS</div><div><span class="calc-result-value" id="nihss-total">0</span><span class="calc-result-max"> / 42</span></div><div id="nihss-interp" style="margin-top:16px"><span class="severity-badge" style="background:rgba(16,185,129,0.15);color:#10b981">No Symptoms</span></div></div>';
    c.innerHTML=h;
    c.querySelectorAll('.calc-option').forEach(function(opt){
      opt.addEventListener('click',function(){
        var id=this.getAttribute('data-item'),s=parseInt(this.getAttribute('data-score'));
        this.parentElement.querySelectorAll('.calc-option').forEach(function(o){o.classList.remove('selected')});
        this.classList.add('selected');this.querySelector('input').checked=true;
        state.nihss[id]=s;updateNIHSS();
      });
    });
  }

  function updateNIHSS(){
    var t=0;for(var k in state.nihss)t+=state.nihss[k];
    $('nihss-total').textContent=t;
    var sev,col;
    if(t===0){sev='No Symptoms';col='#10b981'}
    else if(t<=4){sev='Minor';col='#6ee7b7'}
    else if(t<=15){sev='Moderate';col='#fbbf24'}
    else if(t<=20){sev='Mod-Severe';col='#f97316'}
    else{sev='Severe';col='#ef4444'}
    $('nihss-interp').innerHTML='<span class="severity-badge" style="background:'+col+'20;color:'+col+'">'+sev+'</span>';
  }

  function renderSEDAN(){
    var c=$('sedan-calculator'),h='';
    SEDAN.forEach(function(item){
      h+='<div class="calc-item"><div class="calc-item-header"><span class="calc-item-num">'+item.letter+'</span><span class="calc-item-name">'+item.name+'</span></div><div class="calc-options">';
      item.opts.forEach(function(o){h+='<label class="calc-option" data-item="'+item.id+'" data-score="'+o.s+'"><input type="radio" name="s_'+item.id+'" value="'+o.s+'"><span class="calc-option-score">+'+o.s+'</span><span class="calc-option-label">'+o.l+'</span></label>'});
      h+='</div></div>';
    });
    h+='<div class="calc-result"><div class="calc-result-label">SEDAN Score</div><div><span class="calc-result-value" id="sedan-total">0</span><span class="calc-result-max"> / 6</span></div><div style="margin-top:12px"><span style="color:var(--muted)">sICH Risk: </span><span id="sedan-risk" style="font-size:1.5rem;font-weight:700;color:#10b981">1.4%</span></div><div id="sedan-interp" style="margin-top:16px"><span class="severity-badge" style="background:rgba(16,185,129,0.15);color:#10b981">Very Low</span></div></div>';
    c.innerHTML=h;
    c.querySelectorAll('.calc-option').forEach(function(opt){
      opt.addEventListener('click',function(){
        var id=this.getAttribute('data-item'),s=parseInt(this.getAttribute('data-score'));
        this.parentElement.querySelectorAll('.calc-option').forEach(function(o){o.classList.remove('selected')});
        this.classList.add('selected');this.querySelector('input').checked=true;
        state.sedan[id]=s;updateSEDAN();
      });
    });
  }

  function updateSEDAN(){
    var t=0;for(var k in state.sedan)t+=state.sedan[k];
    $('sedan-total').textContent=t;
    var risks=['1.4%','2.9%','5.0%','8.5%','12.2%','16.9%','21.5%'];
    var levels=['Very Low','Low','Low-Mod','Moderate','Mod-High','High','Very High'];
    var colors=['#10b981','#6ee7b7','#84cc16','#fbbf24','#f97316','#ef4444','#dc2626'];
    var i=Math.min(t,6);
    $('sedan-risk').textContent=risks[i];$('sedan-risk').style.color=colors[i];
    $('sedan-interp').innerHTML='<span class="severity-badge" style="background:'+colors[i]+'20;color:'+colors[i]+'">'+levels[i]+' Risk</span>';
  }

  function init(){
    var btn=$('btn-login');
    if(btn){btn.addEventListener('click',function(e){e.preventDefault();login()});btn.addEventListener('touchend',function(e){e.preventDefault();login()})}
    var inp=$('input-name');if(inp)inp.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();login()}});
    var ref=$('btn-refresh');if(ref)ref.addEventListener('click',loadPatients);
    var rn=$('btn-reset-nihss');if(rn)rn.addEventListener('click',function(){state.nihss={};renderNIHSS()});
    var rs=$('btn-reset-sedan');if(rs)rs.addEventListener('click',function(){state.sedan={};renderSEDAN()});
    setupTabs();renderNIHSS();renderSEDAN();checkSession();
  }

  if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',init);else init();
})();
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>MedWard Pro • System Monitor</title>

  <style>
    :root{
      --bg:#0b1220; --panel:#0f1a2e; --panel2:#0c1628;
      --text:#e7eefc; --muted:#9fb0d0; --muted2:#7e92bb;
      --line:rgba(255,255,255,.08);
      --good:#35d07f; --warn:#ffcc66; --bad:#ff5c7a; --info:#7aa7ff;
      --chip:rgba(122,167,255,.14);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 700px at 20% -10%, rgba(122,167,255,.22), transparent 60%),
               radial-gradient(900px 600px at 100% 0%, rgba(53,208,127,.12), transparent 55%),
               var(--bg);
      color:var(--text); font-family:var(--sans);
    }
    a{color:inherit}
    .wrap{max-width:1280px; margin:0 auto; padding:18px 14px 42px}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 14px; border:1px solid var(--line); border-radius:var(--radius);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow:var(--shadow);
      position:sticky; top:10px; z-index:50; backdrop-filter: blur(10px);
    }
    .brand{display:flex; flex-direction:column; gap:2px}
    .title{font-weight:800; letter-spacing:.2px; font-size:16px}
    .subtitle{color:var(--muted); font-size:12px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .pill{
      display:inline-flex; gap:8px; align-items:center; padding:8px 10px;
      border:1px solid var(--line); border-radius:999px;
      background:rgba(255,255,255,.03);
      color:var(--muted); font-size:12px;
    }
    .dot{width:8px;height:8px;border-radius:99px; background:var(--info); box-shadow:0 0 0 4px rgba(122,167,255,.12)}
    .dot.good{background:var(--good); box-shadow:0 0 0 4px rgba(53,208,127,.12)}
    .dot.warn{background:var(--warn); box-shadow:0 0 0 4px rgba(255,204,102,.12)}
    .dot.bad{background:var(--bad); box-shadow:0 0 0 4px rgba(255,92,122,.12)}

    .grid{
      margin-top:14px;
      display:grid; gap:12px;
      grid-template-columns: 1.1fr .9fr;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      header{top:0; border-radius:0; margin:-18px -14px 0; padding:16px 14px}
    }

    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card-h{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 12px; border-bottom:1px solid var(--line);
      background:rgba(0,0,0,.10);
    }
    .card-h b{font-size:13px; letter-spacing:.2px}
    .card-h span{color:var(--muted); font-size:12px}
    .card-b{padding:12px}

    .stats{display:grid; gap:10px; grid-template-columns:repeat(4,1fr)}
    @media (max-width: 980px){ .stats{grid-template-columns:repeat(2,1fr)} }
    .stat{
      padding:10px 10px; border:1px solid var(--line); border-radius:14px;
      background:rgba(255,255,255,.03);
    }
    .stat .k{color:var(--muted); font-size:12px}
    .stat .v{font-weight:800; margin-top:4px; font-size:16px}
    .stat .s{margin-top:4px; font-size:12px; color:var(--muted2); font-family:var(--mono); overflow:hidden; text-overflow:ellipsis; white-space:nowrap}

    .controls{display:flex; gap:10px; flex-wrap:wrap}
    button, select, input{
      font:inherit; color:inherit;
      border:1px solid var(--line); background:rgba(255,255,255,.03);
      border-radius:12px; padding:10px 10px;
      outline:none;
    }
    button{cursor:pointer}
    button:hover{background:rgba(255,255,255,.06)}
    .btn{
      display:inline-flex; gap:8px; align-items:center; white-space:nowrap;
    }
    .btn.good{border-color:rgba(53,208,127,.35)}
    .btn.warn{border-color:rgba(255,204,102,.35)}
    .btn.bad{border-color:rgba(255,92,122,.35)}
    .btn.mono{font-family:var(--mono); font-size:12px}

    .two{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width: 980px){ .two{grid-template-columns:1fr} }

    .log{
      height:520px; overflow:auto; border:1px solid var(--line);
      border-radius:14px; background:rgba(0,0,0,.18);
      font-family:var(--mono); font-size:12px;
    }
    .log .item{
      padding:10px 10px; border-bottom:1px solid rgba(255,255,255,.06);
      display:grid; gap:6px;
    }
    .log .top{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .tag{
      padding:3px 8px; border-radius:999px;
      background:var(--chip);
      border:1px solid rgba(122,167,255,.25);
      color:#cfe0ff;
      font-size:11px;
    }
    .tag.good{background:rgba(53,208,127,.12); border-color:rgba(53,208,127,.28); color:#bdf6d7}
    .tag.warn{background:rgba(255,204,102,.14); border-color:rgba(255,204,102,.30); color:#ffe6b0}
    .tag.bad{background:rgba(255,92,122,.14); border-color:rgba(255,92,122,.30); color:#ffc1cc}
    .t{color:var(--muted2)}
    .msg{white-space:pre-wrap; word-break:break-word}
    .kv{display:flex; gap:8px; flex-wrap:wrap; color:var(--muted)}
    .kv code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:8px}

    .mini{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px;
      font-family:var(--mono);
      font-size:12px;
      overflow:auto;
      max-height:240px;
    }
    .footer{
      margin-top:12px; color:var(--muted);
      font-size:12px; line-height:1.5;
    }
  </style>
</head>
<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="title">MedWard Pro • System Monitor</div>
      <div class="subtitle" id="subtitle">Instrumentation active • Real-time diagnostics</div>
    </div>
    <div class="row">
      <div class="pill" title="Sync health (heartbeat + last error)">
        <span class="dot" id="healthDot"></span>
        <span id="healthText">Booting…</span>
      </div>
      <div class="pill" title="Session correlation ID">
        <span>Session</span>
        <span style="font-family:var(--mono)" id="sessionId">—</span>
      </div>
      <button class="btn mono" id="btnCopySession">Copy</button>
    </div>
  </header>

  <div class="grid">

    <!-- LEFT: logs + filters -->
    <section class="card">
      <div class="card-h">
        <b>Event Stream</b>
        <span id="logMeta">0 events</span>
      </div>
      <div class="card-b">

        <div class="controls" style="margin-bottom:10px">
          <select id="filterLevel">
            <option value="ALL">All levels</option>
            <option value="INFO">Info</option>
            <option value="WARN">Warn</option>
            <option value="ERROR">Error</option>
            <option value="SUCCESS">Success</option>
          </select>

          <select id="filterType">
            <option value="ALL">All types</option>
            <option value="APP">APP</option>
            <option value="NET">NET</option>
            <option value="SYNC">SYNC</option>
            <option value="STORE">STORE</option>
            <option value="PERF">PERF</option>
            <option value="TEST">TEST</option>
            <option value="SEC">SEC</option>
          </select>

          <input id="search" placeholder="Search message / tags / meta…" style="min-width:240px; flex:1" />
          <button class="btn" id="btnPause">Pause</button>
          <button class="btn warn" id="btnClear">Clear</button>
          <button class="btn good" id="btnExport">Export JSON</button>
          <button class="btn" id="btnCopy">Copy Logs</button>
        </div>

        <div class="log" id="log"></div>

        <div class="footer">
          Tip: Instrument your app to emit <code>monitor.emit("SYNC", "INFO", "...")</code> for every save/sync/delete path.
          Use correlation IDs to track a single operation across multiple calls.
        </div>
      </div>
    </section>

    <!-- RIGHT: stats + actions -->
    <aside style="display:grid; gap:12px">

      <section class="card">
        <div class="card-h">
          <b>Vitals</b>
          <span id="vitalsMeta">Live</span>
        </div>
        <div class="card-b">
          <div class="stats">
            <div class="stat">
              <div class="k">Network avg</div>
              <div class="v" id="netAvg">—</div>
              <div class="s" id="netAvgS">ms</div>
            </div>
            <div class="stat">
              <div class="k">Slow calls</div>
              <div class="v" id="netSlow">—</div>
              <div class="s" id="netSlowS">&gt; 1500ms</div>
            </div>
            <div class="stat">
              <div class="k">Errors</div>
              <div class="v" id="errCount">—</div>
              <div class="s" id="errLast">last: —</div>
            </div>
            <div class="stat">
              <div class="k">Long tasks</div>
              <div class="v" id="longTasks">—</div>
              <div class="s" id="longTaskS">&gt; 200ms</div>
            </div>
          </div>

          <div class="two" style="margin-top:10px">
            <div>
              <div class="pill" style="width:100%; justify-content:space-between">
                <span>Online</span>
                <span style="font-family:var(--mono)" id="online">—</span>
              </div>
              <div class="pill" style="width:100%; justify-content:space-between; margin-top:8px">
                <span>Effective type</span>
                <span style="font-family:var(--mono)" id="netType">—</span>
              </div>
              <div class="pill" style="width:100%; justify-content:space-between; margin-top:8px">
                <span>RTT / Downlink</span>
                <span style="font-family:var(--mono)" id="rtt">—</span>
              </div>
            </div>
            <div>
              <div class="pill" style="width:100%; justify-content:space-between">
                <span>Memory</span>
                <span style="font-family:var(--mono)" id="mem">—</span>
              </div>
              <div class="pill" style="width:100%; justify-content:space-between; margin-top:8px">
                <span>LocalStorage</span>
                <span style="font-family:var(--mono)" id="ls">—</span>
              </div>
              <div class="pill" style="width:100%; justify-content:space-between; margin-top:8px">
                <span>Build</span>
                <span style="font-family:var(--mono)" id="build">—</span>
              </div>
            </div>
          </div>

        </div>
      </section>

      <section class="card">
        <div class="card-h">
          <b>Actions • Tests</b>
          <span>Run targeted diagnostics</span>
        </div>
        <div class="card-b">
          <div class="controls">
            <button class="btn good" id="btnHeartbeat">Heartbeat</button>
            <button class="btn" id="btnFetchTest">Fetch test</button>
            <button class="btn" id="btnSyncTest">Sync test</button>
            <button class="btn warn" id="btnSaveTest">Save test</button>
            <button class="btn bad" id="btnDeleteTest">Delete test</button>
            <button class="btn" id="btnThrow">Simulate error</button>
          </div>

          <div style="margin-top:12px" class="mini" id="mini">
Ready. Link this monitor to your app by opening the app in another tab
and instrumenting functions to call window.monitor.emit(...).
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-h">
          <b>Live Snapshot</b>
          <span>Last event meta</span>
        </div>
        <div class="card-b">
          <pre class="mini" id="snapshot">{}</pre>
        </div>
      </section>

    </aside>
  </div>
</div>

<script src="./monitor.js"></script>
<script>
  // Optional: mark build/version from query param or global.
  const build = new URLSearchParams(location.search).get("v") || "dev";
  document.getElementById("build").textContent = build;
  if (window.monitor) window.monitor.emit("APP","INFO","Monitor loaded", { build });
</script>
</body>
</html>

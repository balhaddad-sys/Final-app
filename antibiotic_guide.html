<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Antibiotic Stewardship Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #005eb8;
  --primary-dark: #003087;
  --bg: #f3f4f6;
  --bg-card: #ffffff;
  --text-main: #0f172a;
  --text-secondary: #475569;
  --text-muted: #94a3b8;
  --border: #e2e8f0;
  --success: #059669;
  --danger: #dc2626;
  --warning: #d97706;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text-main);
  min-height: 100vh;
  padding-bottom: 80px;
  -webkit-font-smoothing: antialiased;
}

/* Header */
.app-header {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  padding: 16px 20px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}
.header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 600px;
  margin: 0 auto;
}
.header-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.header-icon {
  width: 40px;
  height: 40px;
  background: rgba(255,255,255,0.2);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
}
.header-title { font-weight: 700; font-size: 1.1rem; }
.header-subtitle { font-size: 0.75rem; opacity: 0.9; }
.back-btn {
  width: 44px;
  height: 44px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.1);
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Disclaimer */
.disclaimer {
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  border-left: 4px solid #f59e0b;
  margin: 16px;
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 0.8rem;
  color: #92400e;
}
.disclaimer strong { color: #78350f; }

/* Main Content */
.main-content {
  max-width: 600px;
  margin: 0 auto;
  padding: 0 16px;
}

/* System Grid */
.system-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 16px;
}

.abx-tile {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.abx-tile:active { transform: scale(0.96); background: #f8fafc; }
.abx-tile:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.abx-icon { font-size: 2.5rem; display: block; margin-bottom: 12px; }
.abx-label { font-weight: 700; font-size: 0.95rem; color: var(--text-main); display: block; }
.abx-count { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }

/* Detail View */
.detail-view {
  display: none;
}
.detail-view.active {
  display: block;
}
.system-grid.hidden {
  display: none;
}

.back-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: #3b82f6;
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 16px;
  cursor: pointer;
  padding: 8px 0;
}
.back-link:hover { text-decoration: underline; }

.category-title {
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--text-main);
  margin-bottom: 16px;
}

/* Protocol Card */
.proto-card {
  background: var(--bg-card);
  border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  overflow: hidden;
  border: 1px solid var(--border);
}

.proto-header {
  padding: 14px 16px;
  background: linear-gradient(135deg, #f8fafc, #f1f5f9);
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 12px;
}
.proto-name {
  font-weight: 700;
  font-size: 1rem;
  color: var(--text-main);
}
.proto-source {
  font-size: 0.65rem;
  color: white;
  font-weight: 600;
  background: linear-gradient(135deg, #6366f1, #8b5cf6);
  padding: 4px 8px;
  border-radius: 6px;
  white-space: nowrap;
}

.proto-criteria {
  padding: 12px 16px;
  background: linear-gradient(135deg, #fff7ed, #ffedd5);
  border-bottom: 1px solid #fed7aa;
  font-size: 0.85rem;
  color: #9a3412;
}
.proto-criteria strong { color: #7c2d12; }

.regimen-box {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
}
.regimen-box:last-of-type {
  border-bottom: none;
}

.regimen-tag {
  display: inline-block;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  padding: 4px 10px;
  border-radius: 6px;
  margin-bottom: 8px;
}
.tag-primary { background: #dcfce7; color: #166534; }
.tag-allergy { background: #fee2e2; color: #991b1b; }
.tag-alt { background: #dbeafe; color: #1e40af; }
.tag-risk { background: #fef3c7; color: #92400e; }

.regimen-drug {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-main);
  font-family: 'JetBrains Mono', monospace;
  margin-bottom: 6px;
  line-height: 1.4;
}
.regimen-notes {
  font-size: 0.8rem;
  color: var(--text-secondary);
  display: flex;
  align-items: flex-start;
  gap: 6px;
}

.proto-duration {
  padding: 12px 16px;
  background: linear-gradient(135deg, #f0fdf4, #dcfce7);
  font-size: 0.85rem;
  color: #166534;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Search */
.search-box {
  margin: 16px 0;
  position: relative;
}
.search-input {
  width: 100%;
  padding: 14px 16px 14px 44px;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 16px;
  background: var(--bg-card);
  color: var(--text-main);
  font-family: inherit;
}
.search-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}
.search-icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.1rem;
  color: var(--text-muted);
}

/* Bottom Nav */
.bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg-card);
  border-top: 1px solid var(--border);
  padding: 8px 16px;
  padding-bottom: calc(8px + env(safe-area-inset-bottom));
  display: flex;
  justify-content: space-around;
  z-index: 1000;
}
.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 10px 20px;
  border-radius: 12px;
  cursor: pointer;
  color: var(--text-muted);
  font-size: 0.7rem;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.2s;
}
.nav-item:hover { color: var(--primary); }
.nav-item.active { color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
.nav-icon { font-size: 1.3rem; }

.hidden { display: none !important; }
</style>
</head>
<body>

<header class="app-header">
  <div class="header-row">
    <div class="header-brand">
      <div class="header-icon">üõ°Ô∏è</div>
      <div>
        <div class="header-title">Antibiotic Stewardship</div>
        <div class="header-subtitle">IDSA & UpToDate Guidelines</div>
      </div>
    </div>
    <button class="back-btn" onclick="goBack()">‚úï</button>
  </div>
</header>

<div class="disclaimer">
  <strong>‚ö†Ô∏è Clinical Disclaimer:</strong> Always verify with your local hospital antibiogram and adjust for patient-specific factors (allergies, renal function, prior cultures).
</div>

<div class="main-content">
  <div class="search-box">
    <span class="search-icon">üîç</span>
    <input type="text" class="search-input" id="searchInput" placeholder="Search conditions or antibiotics..." oninput="handleSearch()">
  </div>

  <div class="system-grid" id="systemGrid"></div>
  
  <div class="detail-view" id="detailView">
    <div class="back-link" onclick="resetView()">‚Üê Back to Systems</div>
    <h2 class="category-title" id="categoryTitle"></h2>
    <div id="protocolList"></div>
  </div>
  
  <div id="searchResults" class="hidden"></div>
</div>

<nav class="bottom-nav">
  <a class="nav-item" href="index.html"><div class="nav-icon">üè†</div><span>Home</span></a>
  <div class="nav-item active"><div class="nav-icon">üõ°Ô∏è</div><span>Antibiotics</span></div>
  <a class="nav-item" href="oncall_assistant.html"><div class="nav-icon">‚ö°</div><span>OnCall</span></a>
</nav>

<script>
/**
 * ANTIBIOTIC STEWARDSHIP DATABASE
 * Sources: IDSA Guidelines 2019-2023, UpToDate, BMJ Best Practice
 */
const ABX_PROTOCOLS = {
  "Respiratory": {
    icon: "ü´Å",
    color: "#3b82f6",
    conditions: [
      {
        name: "CAP - Ward Patient (Non-ICU)",
        source: "IDSA/ATS 2019",
        criteria: "No MRSA/Pseudomonas risk factors.",
        regimens: [
          { type: "Primary", drug: "Ceftriaxone 1g IV Daily + Azithromycin 500mg IV/PO Daily", notes: "Standard Beta-lactam + Macrolide coverage." },
          { type: "PCN Allergy", drug: "Levofloxacin 750mg IV/PO Daily", notes: "Respiratory Fluoroquinolone monotherapy." },
          { type: "Aspiration Risk", drug: "Ampicillin-Sulbactam 3g IV q6h", notes: "Add Anaerobic coverage." }
        ],
        duration: "5-7 days (Stop when afebrile for 48h)"
      },
      {
        name: "CAP - ICU Patient",
        source: "IDSA/ATS 2019",
        criteria: "Severe CAP requiring ICU admission.",
        regimens: [
          { type: "Primary", drug: "Ceftriaxone 1g IV Daily + Azithromycin 500mg IV Daily", notes: "OR Ceftriaxone + Levofloxacin." },
          { type: "Pseudomonas Risk", drug: "Pip/Tazo 4.5g IV q6h + Levofloxacin 750mg Daily", notes: "Structural lung disease, prior Pseudomonas." },
          { type: "MRSA Risk", drug: "Add Vancomycin (trough 15-20)", notes: "Recent influenza, cavitary infiltrate, empyema." }
        ],
        duration: "7 days minimum"
      },
      {
        name: "HAP (Hospital Acquired)",
        source: "IDSA 2016",
        criteria: "Pneumonia >48h after admission. Low mortality risk.",
        regimens: [
          { type: "Standard", drug: "Pip/Tazo 4.5g IV q6h OR Cefepime 2g IV q8h", notes: "Cover Pseudomonas & MSSA." },
          { type: "High MRSA Risk", drug: "Add Vancomycin (trough 15-20)", notes: "If prior IV abx within 90 days or MRSA prevalence >20%." }
        ],
        duration: "7 days"
      },
      {
        name: "COPD Exacerbation",
        source: "GOLD 2023",
        criteria: "Increased dyspnea + purulent sputum + increased sputum volume (2 of 3).",
        regimens: [
          { type: "Outpatient", drug: "Amoxicillin 500mg TID OR Doxycycline 100mg BID", notes: "5-7 day course." },
          { type: "Inpatient", drug: "Azithromycin 500mg Daily OR Levofloxacin 750mg Daily", notes: "Consider Pseudomonas coverage if severe." }
        ],
        duration: "5-7 days"
      }
    ]
  },
  "Urinary": {
    icon: "üöΩ",
    color: "#f59e0b",
    conditions: [
      {
        name: "Acute Cystitis (Uncomplicated)",
        source: "IDSA 2011",
        criteria: "No fever, no flank pain, non-pregnant female.",
        regimens: [
          { type: "First Line", drug: "Nitrofurantoin 100mg PO BID x 5 days", notes: "Avoid if CrCl < 30." },
          { type: "Second Line", drug: "TMP-SMX DS BID x 3 days", notes: "Avoid if local resistance > 20%." },
          { type: "Alternative", drug: "Fosfomycin 3g PO x 1 dose", notes: "Single dose, less effective." }
        ],
        duration: "As above"
      },
      {
        name: "Pyelonephritis (Outpatient)",
        source: "IDSA 2011",
        criteria: "Mild-moderate, able to tolerate PO, compliant.",
        regimens: [
          { type: "Primary", drug: "Ciprofloxacin 500mg BID x 7 days", notes: "Or Levofloxacin 750mg Daily x 5 days." },
          { type: "If FQ Resistant", drug: "TMP-SMX DS BID x 14 days", notes: "Only if susceptible." }
        ],
        duration: "5-14 days depending on agent"
      },
      {
        name: "Pyelonephritis (Inpatient)",
        source: "IDSA 2011",
        criteria: "Fever, flank pain, or unable to tolerate PO.",
        regimens: [
          { type: "Primary", drug: "Ceftriaxone 1g IV Daily", notes: "Excellent E. coli coverage." },
          { type: "PCN Allergy", drug: "Ciprofloxacin 400mg IV q12h", notes: "If susceptible." },
          { type: "ESBL Risk", drug: "Meropenem 1g IV q8h", notes: "History of ESBL or critical illness." }
        ],
        duration: "7-14 days"
      },
      {
        name: "Catheter-Associated UTI (CAUTI)",
        source: "IDSA 2010",
        criteria: "Symptomatic + catheter in place >48h. Remove/change catheter!",
        regimens: [
          { type: "Standard", drug: "Ceftriaxone 1g IV Daily", notes: "Broad gram-negative coverage." },
          { type: "Pseudomonas Risk", drug: "Cefepime 2g IV q8h OR Pip/Tazo", notes: "Long-term catheter, recent abx." }
        ],
        duration: "7 days (14 if slow response)"
      }
    ]
  },
  "Sepsis / Blood": {
    icon: "ü©∏",
    color: "#dc2626",
    conditions: [
      {
        name: "Sepsis of Unclear Source",
        source: "Surviving Sepsis 2021",
        criteria: "Hemodynamic instability or organ dysfunction. START WITHIN 1 HOUR.",
        regimens: [
          { type: "Broad Spectrum", drug: "Vancomycin + Pip/Tazo 4.5g IV q6h", notes: "Covers MRSA + Pseudomonas + Anaerobes." },
          { type: "PCN Allergy", drug: "Vancomycin + Aztreonam + Metronidazole", notes: "Aztreonam safe in PCN allergy." },
          { type: "Immunocompromised", drug: "Add Caspofungin if fungal risk", notes: "Neutropenia, TPN, prior abx." }
        ],
        duration: "De-escalate based on cultures @ 48h"
      },
      {
        name: "Gram Positive Bacteremia (MSSA)",
        source: "IDSA 2015",
        criteria: "Blood culture positive for MSSA.",
        regimens: [
          { type: "Primary", drug: "Cefazolin 2g IV q8h", notes: "Preferred over Nafcillin (less nephrotoxic)." },
          { type: "PCN Allergy", drug: "Vancomycin (trough 15-20)", notes: "Only if true anaphylaxis." }
        ],
        duration: "2 weeks (uncomplicated) / 4-6 weeks (endocarditis)"
      },
      {
        name: "Gram Positive Bacteremia (MRSA)",
        source: "IDSA 2011",
        criteria: "Blood culture positive for MRSA.",
        regimens: [
          { type: "Primary", drug: "Vancomycin (trough 15-20 AUC/MIC guided)", notes: "Standard of care." },
          { type: "Vanc Intolerant", drug: "Daptomycin 8-10mg/kg IV Daily", notes: "NOT for pneumonia (inactivated by surfactant)." }
        ],
        duration: "2 weeks minimum, 4-6 weeks if complicated"
      },
      {
        name: "Gram Negative Bacteremia",
        source: "UpToDate 2023",
        criteria: "Blood culture with GNR. Source control critical.",
        regimens: [
          { type: "Empiric", drug: "Ceftriaxone 2g IV Daily OR Cefepime 2g IV q8h", notes: "Adjust based on sensitivities." },
          { type: "ESBL Suspected", drug: "Meropenem 1g IV q8h", notes: "Prior ESBL, recent hospitalization." },
          { type: "Pseudomonas", drug: "Cefepime 2g IV q8h + Tobramycin", notes: "Double coverage initially, de-escalate." }
        ],
        duration: "7-14 days depending on source"
      }
    ]
  },
  "Skin/Soft Tissue": {
    icon: "ü¶µ",
    color: "#10b981",
    conditions: [
      {
        name: "Cellulitis (Non-Purulent)",
        source: "IDSA 2014",
        criteria: "Erythema, warmth, swelling. No abscess or purulent drainage.",
        regimens: [
          { type: "Outpatient", drug: "Cephalexin 500mg QID x 5 days", notes: "Targets Strep & MSSA." },
          { type: "Inpatient", drug: "Cefazolin 1-2g IV q8h", notes: "Step down to PO when improving." },
          { type: "PCN Allergy", drug: "Clindamycin 300-450mg TID", notes: "Watch for C. diff." }
        ],
        duration: "5 days (extend if not improving)"
      },
      {
        name: "Cellulitis (Purulent/Abscess)",
        source: "IDSA 2014",
        criteria: "Abscess present OR purulent drainage. I&D IS PRIMARY TREATMENT.",
        regimens: [
          { type: "Post I&D", drug: "TMP-SMX DS BID x 5-7 days", notes: "MRSA coverage. May not need abx if I&D adequate." },
          { type: "Severe", drug: "Vancomycin IV + I&D", notes: "Systemic signs, immunocompromised." }
        ],
        duration: "5-7 days"
      },
      {
        name: "Diabetic Foot Infection (Mild)",
        source: "IDSA 2012",
        criteria: "Superficial ulcer, <2cm erythema, no systemic signs.",
        regimens: [
          { type: "Primary", drug: "Cephalexin 500mg QID OR Amox/Clav 875mg BID", notes: "Strep + MSSA." },
          { type: "MRSA Risk", drug: "Add TMP-SMX DS BID or Doxycycline", notes: "Prior MRSA, high local prevalence." }
        ],
        duration: "1-2 weeks"
      },
      {
        name: "Diabetic Foot Infection (Moderate-Severe)",
        source: "IDSA 2012",
        criteria: ">2cm erythema, deep tissue involvement, systemic signs.",
        regimens: [
          { type: "Standard", drug: "Pip/Tazo 4.5g IV q8h OR Amp/Sulbactam 3g IV q6h", notes: "Polymicrobial coverage including anaerobes." },
          { type: "MRSA Risk", drug: "Add Vancomycin", notes: "Prior MRSA, failed outpatient tx." },
          { type: "Pseudomonas Risk", drug: "Pip/Tazo + Ciprofloxacin", notes: "Water exposure, chronic wound." }
        ],
        duration: "2-4 weeks, longer if osteomyelitis"
      },
      {
        name: "Necrotizing Fasciitis",
        source: "IDSA 2014",
        criteria: "SURGICAL EMERGENCY. Pain out of proportion, crepitus, bullae, sepsis.",
        regimens: [
          { type: "Empiric", drug: "Vancomycin + Pip/Tazo + Clindamycin", notes: "Clindamycin inhibits toxin production." },
          { type: "Alternative", drug: "Vanc + Meropenem + Clindamycin", notes: "If PCN allergy (not anaphylaxis)." }
        ],
        duration: "Continue until debridements complete + clinical improvement"
      }
    ]
  },
  "Intra-abdominal": {
    icon: "ü´É",
    color: "#8b5cf6",
    conditions: [
      {
        name: "Appendicitis (Uncomplicated)",
        source: "SIS 2017",
        criteria: "Non-perforated, no abscess.",
        regimens: [
          { type: "Pre-op Only", drug: "Cefazolin 2g IV x 1", notes: "Single dose prophylaxis if surgery planned." },
          { type: "Non-operative", drug: "Ciprofloxacin + Metronidazole", notes: "If surgery delayed or refused." }
        ],
        duration: "24h post-op (or 5-7 days if non-op)"
      },
      {
        name: "Appendicitis (Complicated/Perforated)",
        source: "SIS 2017",
        criteria: "Perforation, abscess, or peritonitis.",
        regimens: [
          { type: "Primary", drug: "Pip/Tazo 4.5g IV q6h", notes: "Monotherapy covering anaerobes." },
          { type: "Alternative", drug: "Ceftriaxone 1g Daily + Metronidazole 500mg q8h", notes: "If Pip/Tazo unavailable." }
        ],
        duration: "4-5 days post source control"
      },
      {
        name: "Cholecystitis/Cholangitis",
        source: "Tokyo Guidelines 2018",
        criteria: "RUQ pain, fever, elevated LFTs.",
        regimens: [
          { type: "Mild-Moderate", drug: "Ceftriaxone 1g IV Daily + Metronidazole 500mg q8h", notes: "OR Amp/Sulbactam 3g q6h." },
          { type: "Severe/Septic", drug: "Pip/Tazo 4.5g IV q6h", notes: "Consider Meropenem if ESBL risk." }
        ],
        duration: "4-7 days (longer if no source control)"
      },
      {
        name: "Spontaneous Bacterial Peritonitis (SBP)",
        source: "AASLD 2021",
        criteria: "Ascites PMN >250/mm¬≥. Cirrhosis patient.",
        regimens: [
          { type: "Primary", drug: "Ceftriaxone 2g IV Daily", notes: "Cover E. coli, Klebsiella, Strep." },
          { type: "Nosocomial SBP", drug: "Pip/Tazo OR Meropenem", notes: "Prior hospitalization, recent abx." }
        ],
        duration: "5 days + Albumin 1.5g/kg Day 1, 1g/kg Day 3"
      },
      {
        name: "C. difficile Infection",
        source: "IDSA/SHEA 2021",
        criteria: "Diarrhea + positive C. diff toxin/PCR. STOP CAUSATIVE ABX.",
        regimens: [
          { type: "Non-Severe", drug: "Fidaxomicin 200mg BID OR Vancomycin 125mg PO QID", notes: "Fidaxomicin preferred (lower recurrence)." },
          { type: "Severe", drug: "Vancomycin 125mg PO QID", notes: "WBC >15k or Cr >1.5x baseline." },
          { type: "Fulminant", drug: "Vanc 500mg PO/NG QID + Metronidazole 500mg IV q8h", notes: "Ileus, toxic megacolon. Surgery consult!" }
        ],
        duration: "10 days (extended for recurrence)"
      }
    ]
  },
  "CNS": {
    icon: "üß†",
    color: "#ec4899",
    conditions: [
      {
        name: "Bacterial Meningitis (Community)",
        source: "IDSA 2004/2017",
        criteria: "Fever, headache, neck stiffness, altered mental status. EMERGENCY.",
        regimens: [
          { type: "Empiric", drug: "Ceftriaxone 2g IV q12h + Vancomycin + Dexamethasone", notes: "Dex 0.15mg/kg q6h x 4d, give BEFORE or WITH first abx dose." },
          { type: "Age >50 or Immunocompromised", drug: "Add Ampicillin 2g IV q4h", notes: "Covers Listeria." },
          { type: "PCN Allergy", drug: "Meropenem + Vancomycin + Dex", notes: "Or Chloramphenicol + Vanc + TMP-SMX." }
        ],
        duration: "10-14 days (7 days for H. flu/Meningococcus)"
      },
      {
        name: "Brain Abscess",
        source: "UpToDate 2023",
        criteria: "Ring-enhancing lesion. Often polymicrobial.",
        regimens: [
          { type: "Empiric", drug: "Ceftriaxone 2g IV q12h + Metronidazole 500mg q8h", notes: "Add Vancomycin if post-surgical or trauma." },
          { type: "Post-Neurosurgery", drug: "Vancomycin + Cefepime + Metronidazole", notes: "Cover MRSA + Pseudomonas." }
        ],
        duration: "4-8 weeks (longer if not drained)"
      }
    ]
  }
};

// Render system grid
function renderSystems() {
  const grid = document.getElementById('systemGrid');
  grid.innerHTML = '';
  
  Object.keys(ABX_PROTOCOLS).forEach(key => {
    const sys = ABX_PROTOCOLS[key];
    const condCount = sys.conditions.length;
    const div = document.createElement('div');
    div.className = 'abx-tile';
    div.style.borderTop = `4px solid ${sys.color}`;
    div.onclick = () => showCategory(key);
    div.innerHTML = `
      <span class="abx-icon">${sys.icon}</span>
      <span class="abx-label">${key}</span>
      <span class="abx-count">${condCount} protocol${condCount > 1 ? 's' : ''}</span>
    `;
    grid.appendChild(div);
  });
}

// Show category detail
function showCategory(category) {
  document.getElementById('systemGrid').classList.add('hidden');
  document.getElementById('detailView').classList.add('active');
  document.getElementById('searchResults').classList.add('hidden');
  document.getElementById('searchInput').value = '';
  
  const sys = ABX_PROTOCOLS[category];
  document.getElementById('categoryTitle').innerHTML = `${sys.icon} ${category} Protocols`;
  
  const container = document.getElementById('protocolList');
  container.innerHTML = '';
  
  sys.conditions.forEach(cond => {
    container.innerHTML += renderProtocolCard(cond, sys.color);
  });
}

// Render a single protocol card
function renderProtocolCard(cond, color) {
  let regimensHTML = '';
  cond.regimens.forEach(reg => {
    let tagClass = 'tag-primary';
    if (reg.type.toLowerCase().includes('allergy')) tagClass = 'tag-allergy';
    else if (reg.type.toLowerCase().includes('risk') || reg.type.toLowerCase().includes('severe')) tagClass = 'tag-risk';
    else if (reg.type.toLowerCase().includes('alternative') || reg.type.toLowerCase().includes('second')) tagClass = 'tag-alt';
    
    regimensHTML += `
      <div class="regimen-box">
        <span class="regimen-tag ${tagClass}">${reg.type}</span>
        <div class="regimen-drug">${reg.drug}</div>
        <div class="regimen-notes">‚ÑπÔ∏è ${reg.notes}</div>
      </div>
    `;
  });

  return `
    <div class="proto-card" style="border-left: 4px solid ${color || '#3b82f6'}">
      <div class="proto-header">
        <span class="proto-name">${cond.name}</span>
        <span class="proto-source">${cond.source}</span>
      </div>
      <div class="proto-criteria">
        <strong>Criteria:</strong> ${cond.criteria}
      </div>
      ${regimensHTML}
      <div class="proto-duration">
        üïí Duration: ${cond.duration}
      </div>
    </div>
  `;
}

// Reset to main view
function resetView() {
  document.getElementById('detailView').classList.remove('active');
  document.getElementById('systemGrid').classList.remove('hidden');
  document.getElementById('searchResults').classList.add('hidden');
  document.getElementById('searchInput').value = '';
}

// Search functionality
function handleSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase().trim();
  
  if (!query) {
    document.getElementById('searchResults').classList.add('hidden');
    document.getElementById('systemGrid').classList.remove('hidden');
    document.getElementById('detailView').classList.remove('active');
    return;
  }
  
  document.getElementById('systemGrid').classList.add('hidden');
  document.getElementById('detailView').classList.remove('active');
  document.getElementById('searchResults').classList.remove('hidden');
  
  const results = [];
  
  Object.keys(ABX_PROTOCOLS).forEach(cat => {
    const sys = ABX_PROTOCOLS[cat];
    sys.conditions.forEach(cond => {
      const matchName = cond.name.toLowerCase().includes(query);
      const matchDrug = cond.regimens.some(r => r.drug.toLowerCase().includes(query));
      const matchCriteria = cond.criteria.toLowerCase().includes(query);
      
      if (matchName || matchDrug || matchCriteria) {
        results.push({ ...cond, category: cat, color: sys.color, icon: sys.icon });
      }
    });
  });
  
  const container = document.getElementById('searchResults');
  if (results.length === 0) {
    container.innerHTML = `<div style="text-align:center;padding:40px;color:var(--text-muted)">
      <div style="font-size:2rem;margin-bottom:12px">üîç</div>
      <div>No results for "${query}"</div>
    </div>`;
  } else {
    container.innerHTML = `<div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:16px">${results.length} result${results.length > 1 ? 's' : ''} found</div>`;
    results.forEach(r => {
      container.innerHTML += `<div style="font-size:0.75rem;color:var(--text-secondary);margin-bottom:8px">${r.icon} ${r.category}</div>`;
      container.innerHTML += renderProtocolCard(r, r.color);
    });
  }
}

// Navigation
function goBack() {
  window.location.href = 'index.html';
}

// Initialize
document.addEventListener('DOMContentLoaded', renderSystems);
</script>
</body>
</html>
